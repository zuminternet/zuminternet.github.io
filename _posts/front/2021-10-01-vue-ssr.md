---
layout: post
title: Vue SSR ì œëŒ€ë¡œ ì ìš©í•˜ê¸° (feat. Vanilla SSR)
description: SSRì— ëŒ€í•œ ê°œë…ì„ ì•Œì•„ë³´ê³ , ì´ë¥¼ ì ìš©í•˜ê¸° ìœ„í•œ ê³¼ì •ì„ ì†Œê°œí•©ë‹ˆë‹¤.
image: /images/front/post/2021-10-01-vue-ssr/thumbnail.png
introduction: Server Side Renderingì— ëŒ€í•œ ê°œë…ì„ ì•Œì•„ë³´ê³ , ì´ë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì„ ì°¨ê·¼ì°¨ê·¼ ì†Œê°œí•©ë‹ˆë‹¤. 
category: portal/tech
tag: [í”„ë¡ íŠ¸ì—”ë“œ, VueJS, Vue, Server Side Rendering, SSR]
author: junilhwang
---

ì•ˆë…•í•˜ì„¸ìš”, ì¤Œì¸í„°ë„· í¬í„¸ê°œë°œíŒ€ í”„ë¡ íŠ¼ì—”ë“œ íŒŒíŠ¸ë¦¬ë” í™©ì¤€ì¼ì…ë‹ˆë‹¤ ğŸ™‡â€â™‚ï¸

ì˜¤ëœë§Œì— ê¸°ìˆ ë¸”ë¡œê·¸ì— íˆ¬ê³ ë¥¼ í•˜ë„¤ìš”. ì–´ë–¤ ê¸€ì„ ì£¼ì œë¡œ ê¸€ì„ ì‘ì„±í•´ì•¼ ìœ ìµí• ê¹Œ ê½¤ ì˜¤ëœ ì‹œê°„ ë™ì•ˆ ê³ ë¯¼ì„ í–ˆìŠµë‹ˆë‹¤.
ì´ë²ˆì—ëŠ” ì œê°€ ì‹¤ë¬´ë¥¼ í•˜ë©´ì„œ ìƒê°ë³´ë‹¤ ê½¤ ë§ì€ ì‚½ì§ˆì„ í–ˆë˜, **SSR(Server Side Rendering)**ì„ ì£¼ì œë¡œ ë‹¤ë¤„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

> ë³¸ í¬ìŠ¤íŠ¸ëŠ” [ëª¨ë°”ì¼ ì¤Œ SpringBoot â†’ NodeJS ì „í™˜ê¸° (feat. VueJS SSR)](https://zuminternet.github.io/ZUM-Mobile-NodeJS/)ì„ ë¨¼ì € ì½ì–´ë³´ë©´ ë” ìœ ìµí•©ë‹ˆë‹¤.

## 1. SSR(Server Side Rendering)ì´ë€?

ì´ ê¸€ì„ ì½ê³  ìˆëŠ” ë§ì€ ë¶„ë“¤ì´ SSRì— ëŒ€í•œ ê°œë…ì€ ì´ë¯¸ ìˆ™ì§€í•˜ê³  ìˆìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤. ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  í•œ ë²ˆ SSRì˜ ê°œë…ì ì¸ ë¶€ë¶„ì„ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.

### (1) ë¬´ì—‡(What) ì¸ê°€

ì €ëŠ” ì›¹ ê°œë°œì„ PHPë¡œ ì ‘í–ˆìŠµë‹ˆë‹¤. PHPëŠ” `Hypertext Preprocessor`ì˜ ì•½ìì¸ë°, í•´ì„í•´ë³´ë©´ **HTML ì „ì²˜ë¦¬ê¸°**ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

> ì „ì²˜ë¦¬ê¸°ë¼ëŠ” ë‹¨ì–´ê°€ ìµìˆ™í•˜ì§€ ì•Šë‚˜ìš”? í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë“¤ì´ ë§ì´ ì‚¬ìš©í•˜ëŠ” SASS, LESS ë“±ì´ ë°”ë¡œ CSSì˜ ì „ì²˜ë¦¬ê¸°(Preprocessor)ì…ë‹ˆë‹¤.
> ëŒ€ì¶© ì–´ë–¤ ëŠë‚Œì¸ì§€ ê°ì´ ì˜¤ì‹œë‚˜ìš”? ë°˜ëŒ€ë¡œ PostCSS ê°™ì€ í›„ì²˜ë¦¬ê¸°ë„ ì¡´ì¬í•œë‹µë‹ˆë‹¤!

ì¦‰, PHPë¥¼ ì´ìš©í•˜ì—¬ **HTMLì„ ë™ì ìœ¼ë¡œ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆëŠ” ê²ƒ**ì…ë‹ˆë‹¤. ì´ì™€ ë¹„ìŠ·í•œ ë„êµ¬ë¡œ JSPì™€ ASPë„ ìˆìŠµë‹ˆë‹¤. ì™„ì „ ë˜‘ê°™ì§„ ì•Šì§€ë§Œ, **JSP(Java Server Page)**ì™€ **ASP(Active Server Pages)**ë„ ì¡´ì¬í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì´ê²ƒë“¤ì´ ì•½ 10ë…„ì „ì¯¤ì— ì›¹ ê°œë°œì˜ ìƒíƒœê³„ë¥¼ ì£¼ë¦„ì¡ê³  ìˆë˜ 3ëŒ€ì¥ì´ì—ˆìŠµë‹ˆë‹¤. ì´ë“¤ì˜ ê³µí†µì ì€ **HTMLì„ Serverì—ì„œ ì •ì œí•˜ì—¬ ì¶œë ¥í•´ì£¼ëŠ” ë„êµ¬**ì…ë‹ˆë‹¤.

ë” ì‰½ê²Œ ë§í•´ì„œ **SSR(Server Side Rendering)**ì„ í•´ì£¼ëŠ” ë„êµ¬ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¡°ê¸ˆ ë”´ ê¸¸ë¡œ ì ‘ì–´ë“  ê²ƒ ê°™ì€ë°, ì •ë¦¬í•˜ìë©´ SSRì€ Serverì—ì„œ HTMLì„ ì •ì œí•˜ì—¬ ì¶œë ¥í•´ì£¼ëŠ” ê¸°ë²•ì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### (2) ì™œ(Why) í•„ìš”í•œê°€

ì‚¬ì‹¤ ì´ê²Œ ì œì¼ ì¤‘ìš”í•œ ì£¼ì œì…ë‹ˆë‹¤. ì™œ SSRì„ í•´ì•¼ í• ê¹Œìš”? ì‚¬ì‹¤ ì•ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ ì „í†µì ì¸ ì›¹ ê°œë°œì€ ì´ë¯¸ SSRì„ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° ë¸Œë¼ìš°ì €ê°€ ë°œì „í•˜ëŠ” ê³¼ì •ì—ì„œ Javascript ë¼ëŠ” ì–¸ì–´ ë˜í•œ ì ì  ì„±ìˆ™í•´ì¡Œê³ , Javascriptë¡œ í•  ìˆ˜ ìˆëŠ” ì¼ë“¤ì´ ì ì  ë§ì•„ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ì„œ DOMì„ ì ì  ë” ì •êµí•˜ê²Œ ë‹¤ë¤„ì•¼í–ˆê³ , jQuery ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œëŠ” í•œê³„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ êµ¬ê¸€ì—ì„œ Angularë¥¼ ë§Œë“¤ì—ˆê³ , ì´ì–´ì„œ í˜ì´ìŠ¤ë¶ì—ì„œëŠ” Component ê¸°ë°˜ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆëŠ” Reactë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ Angularì™€ Reactì˜ ì¥ì ë§Œ ìˆ˜ìš©í•˜ì—¬ ë§Œë“  Vueë„ ë“±ì¥í–ˆì£ .

ì´ëŸ° í”„ë ˆì„ì›Œí¬ì˜ ë“±ì¥ìœ¼ë¡œ **ëª¨ë“  ë Œë”ë§ì„ ì „ë¶€ ë¸Œë¼ìš°ì €(í´ë¼ì´ì–¸íŠ¸)ì—ê²Œ ìœ„ì„**í–ˆê³ , ì´ë¥¼ ì „ë¬¸ìœ¼ë¡œ í•˜ëŠ” `í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì`ë“¤ì´ í•„ìš”í•´ì¡ŒìŠµë‹ˆë‹¤.

í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë“¤ì´ ì£¼ë¡œ í•˜ëŠ” ì¼ì´ ë°”ë¡œ **CSR(Client Side Rendering)**ì¸ ê²ƒì´ì£ . ê·¸ëŸ°ë° CSRì—ëŠ” ì„œë¹„ìŠ¤ì ì¸ í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ê°€ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ëŠ” ìµœì´ˆì˜ HTMLì€ ê³ ì‘ `<div id="app"></div>` í˜¹ì€ `<div id="root"></div>` í•œ ì¤„ ì¸ë°, ì´ë ‡ê²Œ ë  ê²½ìš° êµ¬ê¸€ ê²€ìƒ‰ì—”ì§„ì´ ì‚¬ì´íŠ¸ì˜ ë‚´ìš©ì„ íŒŒì•…í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë¬¼ë¡  `meta`  íƒœê·¸ë¥¼ ì´ìš©í•œë‹¤ë©´ ì–´ëŠì •ë„ ê·¹ë³µí•  ìˆ˜ ìˆìœ¼ë‚˜ ì—­ì‹œ ì •êµí•œ `ìƒ‰ì¸(indexing)`ì—ëŠ” í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

ê·¸ë˜ì„œ ë‹¤ì‹œ `SSR(Server Side Rendering)`ì´ í•„ìš”í•´ì§„ ê²ƒì…ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ê³  ë‹¤ì‹œ PHPë‚˜ JSPë¥¼ ì‚¬ìš©í•  ìˆœ ì—†ëŠ” ìƒí™©ì¸ë°, ì´ë¥¼ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”? ì´ì— ëŒ€í•œ ë‚´ìš©ì€ ë’¤ì—ì„œ ìƒì„¸íˆ ë‹¤ë¤„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

### (3) ì–¸ì œ(When) í•„ìš”í•œê°€

ëª¨ë“  ìƒí™©ì— SSRì„ ì ìš©í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ì—”ì§„ì˜ ìƒ‰ì¸ì´ í•„ìš”í•  ë•Œë§Œ ì ìš©í•˜ë©´ ë˜ê³ , í˜¹ì€ ì‚¬ìš©ìì—ê²Œ ë¹„ì–´ìˆëŠ” í™”ë©´ ì—†ì´ ë¹ ë¥´ê²Œ í˜ì´ì§€ë¥¼ ë³´ì—¬ì¤˜ì•¼í•  ë•Œ í•„ìš”í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ë³´ê³ ìˆëŠ” í˜ì´ì§€ì˜ ê²½ìš° SSRì„ í•˜ë©´ ì˜¤íˆë ¤ ìœ„í—˜í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ì •ë³´ê°€ ë…¸ì¶œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ê´€ë¦¬ì í˜ì´ì§€ì˜ ê²½ìš°ì—ë„ SSRì„ í•˜ë©´ ì˜¤íˆë ¤ ë…ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ëŒ€ì²´ë¡œ ì½˜í…ì¸ ì™€ ê´€ë ¨ëœ ë‚´ìš©ì„ ë³´ì—¬ì£¼ê³  ì‹¶ì„ ë•Œ SSRì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

ê°€ë ¹, ìµœê·¼ì— ì¤Œì¸í„°ë„·ì€ [ZUM ê¸ˆìœµ](https://finance.zum.com) ì„œë¹„ìŠ¤ë¥¼ ëŸ°ì¹­í–ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” ì¼ë¶€ í˜ì´ì§€ì—ë§Œ SSRì„ ì‚¬ìš©í–ˆëŠ”ë°ìš”, íˆ¬ì ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” [íˆ¬ìë…¸íŠ¸ ìƒì„¸í˜ì´ì§€](https://finance.zum.com/investment/view/84)ì™€ [ë‰´ìŠ¤ ìƒì„¸í˜ì´ì§€](https://finance.zum.com/news/article/70975239)ì˜ ê²½ìš° SSRì´ ê¼­ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ í˜ì´ì§€ì˜ ê²½ìš° ì‚¬ì‹¤ ìƒ‰ì¸ì´ ë˜ì§€ ì•Šì•„ë„ í¬ê²Œ ìƒê´€ ì—†ì–´ì„œ CSRë¡œë§Œ ì²˜ë¦¬í•œ ìƒíƒœì…ë‹ˆë‹¤.

- CSRë§Œ ì ìš©í•œ ê²½ìš°

  ![1.png](/images/front/post/2021-10-01-vue-ssr/1.png)

- SSRë„ ì ìš©í•œ ê²½ìš°

  ![2.png](/images/front/post/2021-10-01-vue-ssr/2.png)


### (4) ì–´ë–¤ í”Œë«í¼(Where)ì—ì„œ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ê°€

ìš°ë¦¬ëŠ” Javascriptë¡œ ë§Œë“¤ì–´ì§„ ì½”ë“œë¥¼ Serverì—ì„œ HTMLë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—, SSR ì‘ì—…ì„ ìœ„í•´ì„œ `Node.js`ê°€ ê¼­ í•„ìš”í•©ë‹ˆë‹¤. ì¡°ê¸ˆ í¸ë²•ì„ ì´ìš©í•˜ë©´ Javaì—ì„œë„ Javascript ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆœ ìˆìœ¼ë‚˜ [ëª¨ë°”ì¼ ì¤Œ SpringBoot â†’ NodeJS ì „í™˜ê¸° (feat. VueJS SSR)](https://zuminternet.github.io/ZUM-Mobile-NodeJS/)ì—ì„œ ì–¸ê¸‰ëœ ê²ƒ ì²˜ëŸ¼ í¼í¬ë¨¼ìŠ¤ê°€ ì¢‹ì§€ ì•Šê±°ë‚˜, í˜¸í™˜ì„±ì— ëŒ€í•œ ë¬¸ì œê°€ ìˆê±°ë‚˜, ë„ˆë¬´ ë§ì€ í´ë¦¬í•„ì´ í•„ìš”í•˜ê±°ë‚˜ í•˜ëŠ” ë“±ì˜ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê¼­ `Node.js` ê°€ í•„ìš”í•©ë‹ˆë‹¤.

### (5) ëˆ„ê°€(Who) í•´ì•¼í•˜ëŠ”ê°€

ë‹¹ì—°í•œ ì´ì•¼ê¸°ì§€ë§Œ, ì´ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì˜ ì˜ì—­ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ì„  `Node.js`ì— ëŒ€í•œ ì´í•´ê°€ ê¼­ í•„ìš”í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ë¸Œë¼ìš°ì € í™˜ê²½ê³¼ ì„œë²„ í™˜ê²½ì— ëŒ€í•œ ëª…í™•í•œ ì´í•´ì™€ êµ¬ë¶„ì´ í•„ìš”í•©ë‹ˆë‹¤.

## 2. í”„ë ˆì„ì›Œí¬ ì—†ì´ ì ìš©í•´ë³´ê¸°(Vanilla SSR)

ì¼ë‹¨ í”„ë ˆì„ì›Œí¬ ì—†ì´ SSRì„ ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ì´ì— ëŒ€í•´ ì œëŒ€ë¡œ ë‹¤ë£¨ëŠ” í¬ìŠ¤íŠ¸ê°€ ì—†ì–´ì„œ ì•„ì‰¬ì› ìŠµë‹ˆë‹¤. SSRì— ëŒ€í•œ ê°œë…ì„ í™•ì‹¤í•˜ê²Œ ì§šê³  ë„˜ì–´ê°€ì•¼ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ í•´ê²°í•˜ê¸°ê°€ ìˆ˜ì›”í•©ë‹ˆë‹¤. íŠ¹íˆ **ë¸Œë¼ìš°ì € í™˜ê²½ê³¼ ì„œë²„ í™˜ê²½ì´ ì™„ì „íˆ ë‹¤ë¥´ë‹¤ëŠ” ê²ƒ**ì„ ë¨¼ì € ì¸ì§€í•´ì•¼ í•©ë‹ˆë‹¤. ì¼ë‹¨ êµ¬êµ¬ì ˆì ˆ ì„¤ëª…í•˜ê¸°ë³´ë‹¨ ìš°ë¦¬ëŠ” ê°œë°œìì´ë¯€ë¡œ ì½”ë“œë¡œ ì´ì•¼ê¸°í•´ë´…ì‹œë‹¤.

> í˜„ì¬ ì„¹ì…˜ì— ëŒ€í•œ ì „ì²´ ì½”ë“œëŠ” [ì´ ì €ì¥ì†Œ](https://github.com/JunilHwang/simple-ssr)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>

### (1) ë¨¼ì € CSRì„ ë§Œë“¤ì–´ë´…ì‹œë‹¤.

ë¨¼ì € `Client Side`ì—ì„œ ë§Œë“¤ì–´ì§„ ì½”ë“œë¥¼ ì‚´í´ë´…ì‹œë‹¤. ìµœì†Œí•œì˜ ì´í•´ë¥¼ ìœ„í•´ ì •ë§ ê°„ë‹¨í•œ Todo Listë¥¼ êµ¬ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Client Side Rendering</title>
</head>
<body>
<div id="app"></div>
<script>
  // í•„ìš”í•œ ë°ì´í„°ë¥¼ ì„ ì–¸í•©ë‹ˆë‹¤.
  const todoItems = [
    { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
    { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
    { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
  ];

  // ë°ì´í„°(ìƒíƒœ)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ HTMLë¡œ ë³€í™˜í•´ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
  const TodoList = () => `
    <ul>
      ${todoItems.map(({ id, content, activation }) => `
        <li data-id="${id}">
          <input type="checkbox" ${activation ? 'checked' : ''} />
          <span ${activation ? ' style="text-decoration: line-through;"' : ''}>${content}</span>
        </li>
      `).join('')}
    </ul>
  `;

  // DOMì— ë Œë”ë§ì„ í•´ì£¼ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
  const render = () => {
    const $app = document.querySelector('#app');
    $app.innerHTML = TodoList();
    $app.querySelectorAll('li').forEach(el => {
      el.addEventListener('click', () => {
        const { id } = el.dataset;
        const selectedItem = todoItems.find(v => v.id === Number(id));
        selectedItem.activation = !selectedItem.activation;
        render();
      })
    });
  }

  render();
</script>
</body>
</html>
```

![0.gif](/images/front/post/2021-10-01-vue-ssr/gif/0.gif)

ì•„ë§ˆ ì´í•´í•˜ê¸° ì–´ë ¤ìš´ ì½”ë“œëŠ” ì•„ë‹ˆë¼ê³  ìƒê°í•©ë‹ˆë‹¤. ë‹¤ë§Œ ì´ ì½”ë“œì—ì„œ ì²˜ìŒì— ì¡´ì¬í•˜ëŠ” HTMLì€ `<div id="app"></div>`ë°–ì— ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ê²€ìƒ‰ì—”ì§„ì€ ì´ í˜ì´ì§€ì˜ ë‚´ìš©ì„ í•´ì„í•  ë•Œ ë¬´ë¦¬ê°€ ìˆê² ì£ .

ì´ì œ ìœ„ì˜ ì½”ë“œë¥¼ Server Sideì—ì„œ ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ì²œì²œíˆ ì‚´í´ë´…ì‹œë‹¤. ë¨¼ì € HTMLë¡œ ë³€í™˜í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ì¶œí•´ì•¼ í•©ë‹ˆë‹¤.

### (2) CSR ëª¨ë“ˆí™”

ìœ„ì—ì„œ ì‘ì„±í•œ ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë¶„ë¦¬í•´ë´…ì‹œë‹¤.

```bash
.
â”œâ”€ index.html
â””â”€ src
    â”œâ”€ components.js  # ì–´í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ Componentë¥¼ ëª¨ì•„ë‘ 
    â”œâ”€ store.js       # ì–´í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ stateë¥¼ ëª¨ì•„ë‘ 
    â””â”€ main.js        # ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ entry point
```

#### 1) /index.html

ë¨¼ì € `ë¸Œë¼ìš°ì € ëª¨ë“ˆ`ì„ ì´ìš©í•˜ì—¬ `main.js`ë¥¼ ë¶ˆëŸ¬ì˜¤ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

```html
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Client Side Rendering</title>
</head>
<body>
<div id="app"></div>
<!-- ë¸Œë¼ìš°ì € ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ main.jsë¥¼ ë¶ˆëŸ¬ì˜´ -->
<script src="./src/main.js" type="module"></script>
</body>
</html>
```

ì´ë ‡ê²Œ ì‚¬ìš©í•  ê²½ìš° webpack ê°™ì€ ë²ˆë“¤ë§ ë„êµ¬ê°€ ì—†ì–´ë„ `ESMì„ ì‚¬ìš©`í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 2) /src/store.js

```jsx
export const store = {
  state: {
    todoItems: [
      { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
      { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
      { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
    ],
  },
  setState (newState) {
    this.state = { ...this.state, ...newState  }
  },
  toggleActivation (index) {
    const todoItems = [ ...this.state.todoItems ];
    todoItems[index].activation = !todoItems[index].activation;
    this.setState({ todoItems });
  }
};
```

ì•„ì˜ˆ ëª…ì‹œì ìœ¼ë¡œ `toggleActivation` ì´ë¼ëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ stateë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í•´ë´¤ìŠµë‹ˆë‹¤. ì½”ë“œ ìì²´ëŠ” ë§ì´ ë¶ˆì™„ì „í•˜ì§€ë§Œ, `Storeì˜ ì—­í• ì„ ìˆ˜í–‰`í•˜ëŠ” ì½”ë“œë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 3)  /src/components.js

```jsx
import { store } from "./store.js";

export const TodoList = () => `
  <ul>
    ${store.state.todoItems.map(TodoItem).join('')}
  </ul>
`;

export const TodoItem = ({ id, content, activation }) => `
  <li data-id="${id}">
    <input type="checkbox" ${activation ? 'checked' : ''} />
    <span ${activation ? ' style="text-decoration: line-through;"' : ''}>${content}</span>
  </li>
`;
```

storeì— ìˆëŠ” `todoItems`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ HTML ë¬¸ìì—´ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•´ì£¼ëŠ”, ì¼ì¢…ì˜ ì»´í¬ë„ŒíŠ¸ë¥¼ êµ¬ì„±í•´ë´¤ìŠµë‹ˆë‹¤.

ì´ë ‡ê²Œ ì‘ì„±í•œ `store`ì™€ `components`ì˜ íŠ¹ì§•ì€ `DOM`ì— ì¢…ì†ì ì´ì§€ ì•Šë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¦‰, `Server Side`ì—ì„œ ì‚¬ìš©í•´ë„ ë¬´ë°©í•œ ì½”ë“œì…ë‹ˆë‹¤. ì´ ì ì„ ìœ ì˜ê¹Šê²Œ ì‚´í´ë³´ì‹œë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

#### 4) /src/main.js

```jsx
import { TodoList } from "./components.js";
import { store } from "./store.js";

// DOMì„ ì§ì ‘ì ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
const render = () => {
  const $app = document.querySelector('#app');
  $app.innerHTML = TodoList();
  $app.querySelectorAll('li').forEach(el => {
    el.addEventListener('click', () => {
      const { id } = el.dataset;
      store.toggleActivation(store.state.todoItems.findIndex(v => v.id === Number(id)));
      render();
    })
  });
}

render();
```

`main.js`ì—ì„œëŠ” **DOMì— ì§ì ‘ ì ‘ê·¼í•˜ëŠ” ì½”ë“œê°€ ì¡´ì¬**í•©ë‹ˆë‹¤. **ì´ë²¤íŠ¸ë„ ë“±ë¡**í•˜ê³ , `#app` íƒœê·¸ë¥¼ ì°¾ì•„ì„œ **ë Œë”ë§ì„ í•´ì£¼ëŠ” ì—­í• **ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

### (3) SSR êµ¬ì„±í•´ë³´ê¸°

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ `Server Side Rendering`ì„ êµ¬í˜„í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € í´ë” êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
.
â”œâ”€ package.json
â”œâ”€ app.js             # ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ entry point
â””â”€ src
    â”œâ”€ components.js  # SSRì— í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê´€ë¦¬í•¨
    â”œâ”€ render.js      # HTMLì„ êµ¬ì„±í•´ì£¼ëŠ” ì—­í• ì„ ìˆ˜í–‰
    â””â”€ store.js       # ì–´í”Œë¦¬ì¼€ì´ì…˜ì— í•„ìš”í•œ stateë¥¼ ê´€ë¦¬í•¨
```

#### 1) package.json êµ¬ì„±

ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ì´ì „ì—, package.jsonì„ êµ¬ì„±í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

```bash
# package.json ìƒì„±
> npm init -y

# express ì„¤ì¹˜
> npm install express

# í•„ìš”í•˜ë‹¤ë©´ nodemon ì„¤ì¹˜
> npm install -D nodemon
```

ê·¸ë¦¬ê³  `ESM`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ **package.jsonì˜ typeì„ moduleë¡œ ì •ì˜**í•©ë‹ˆë‹¤.

```js
{
  "name": "03-SSR",
  "version": "1.0.0",
  "description": "Vanilla JSë¡œ ë§Œë“¤ì–´ë³´ëŠ” SSR",
  "main": "app.js",
  "scripts": {
    "serve": "node app.js",
    "serve:watch": "nodemon app.js"
  },
  "type": "module", // ì´ë ‡ê²Œ moduleë¡œ ì •ì˜í•˜ë©´ ESMì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "express": "^4.17.1",
    "nodemon": "^2.0.13"
  }
}
```

#### 2) /src/components.js

ì´ ì½”ë“œëŠ” CSRì—ì„œ ì‘ì„±í•œ componentsì™€ **ì™„ë²½í•˜ê²Œ ë™ì¼**í•©ë‹ˆë‹¤.

```jsx
import { store } from "./store.js";

export const TodoList = () => `
  <ul>
    ${store.state.todoItems.map(TodoItem).join('')}
  </ul>
`;

export const TodoItem = ({ id, content, activation }) => `
  <li data-id="${id}">
    <input type="checkbox" ${activation ? 'checked' : ''} />
    <span ${activation ? ' style="text-decoration: line-through;"' : ''}>${content}</span>
  </li>
`;
```

#### 3) /src/store.js

ë§ˆì°¬ê°€ì§€ë¡œ CSRì—ì„œ ì‘ì„±í•œ **storeì™€ ì™„ë²½í•˜ê²Œ ë™ì¼**í•©ë‹ˆë‹¤.

```jsx
export const store = {
  state: {
    todoItems: [
      { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
      { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
      { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
    ],
  },
  setState (newState) {
    this.state = { ...this.state, ...newState  }
  },
  toggleActivation (index) {
    const todoItems = [ ...this.state.todoItems ];
    todoItems[index].activation = !todoItems[index].activation;
    this.setState({ todoItems });
  }
};
```

#### 4) /src/render.js

í•µì‹¬ì€ ë°”ë¡œ `render.js`ì…ë‹ˆë‹¤. ì½”ë“œ ìì²´ëŠ” ë³„ê²Œ ì—†ìŠµë‹ˆë‹¤.

```jsx
export const render = (RootComponent) => `
  <!doctype html>
  <html lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>Server Side Rendering</title>
  </head>
  <body>
    <div id="app">${RootComponent}</div>
  </body>
  </html>
`;
```

ìœ„ì—ì„œ ë³´ì—¬ì§€ëŠ” ê²ƒ ì²˜ëŸ¼, **html bodyì— componentê°€ ì‚½ì…ë  ìˆ˜ ìˆë„ë¡ ì‘ì—…**í•´ì•¼í•©ë‹ˆë‹¤.

#### 5) /app.js

ë§ˆì§€ë§‰ìœ¼ë¡œ app.jsë¥¼ êµ¬ì„±í•˜ê³ , `render` í•¨ìˆ˜ë¥¼ í†µí•´ `Component`ë¥¼ ì¶œë ¥í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ë©´ ëœë‹µë‹ˆë‹¤.

```jsx
import express from "express";
import { TodoList } from "./src/components.js";
import { render } from "./src/render.js";

const app = express();

app.get("/", (req, res) => {
  res.send(
    render(TodoList())
  );
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000');
})
```

ê²°ê³¼ë¬¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![3.png](/images/front/post/2021-10-01-vue-ssr/3.png)

ì†ŒìŠ¤ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë  ê²ƒì…ë‹ˆë‹¤.

![4.png](/images/front/post/2021-10-01-vue-ssr/4.png)

ìœ„ì˜ ê³¼ì •ì˜ í•µì‹¬ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![5.png](/images/front/post/2021-10-01-vue-ssr/5.png)
*JS ì½”ë“œê°€ ë¸Œë¼ìš°ì €ì™€ NodeJSì— ì–‘ë‹¤ë¦¬ë¥¼ ê±¸ì¹˜ëŠ” ëŠë‚Œ*

- Componentê°€ **DOMì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡** Client ì½”ë“œë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
  - Reactì™€ Vueì—ì„œëŠ” `ê°€ìƒë”`ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— DOMì— ëŒ€í•œ Dependencyê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - Vueì˜ ê²½ìš° create ì‹œì ì— DOMì— ì ‘ê·¼í•  ê²½ìš° SSR ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
  - Reactë„ ì´ˆê¸° Render ì‹œì ì— DOMì— ì ‘ê·¼í•˜ëŠ” ê²½ìš°ê°€ ìˆì„ ê²½ìš° ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²ƒì…ë‹ˆë‹¤.
- Serverì—ì„œ í•´ë‹¹ **Client ì½”ë“œë¥¼ importí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡** êµ¬ì„±í•©ë‹ˆë‹¤.
  - ë³´í†µ clientì˜ ì½”ë“œë¥¼ serverì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ **ë²ˆë“¤ë§í•˜ì—¬ ì œê³µí•˜ëŠ” ê³¼ì •**ì„ ê±°ì¹©ë‹ˆë‹¤.
  - ì´ì— ëŒ€í•œ ë‚´ìš©ë„ ë’¤ì—ì„œ ìƒì„¸íˆ ë‹¤ë£¨ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
- Serverì—ì„œëŠ” Componentë¥¼ **HTML ë¬¸ìì—´**ë¡œ ë³€í™˜í•˜ì—¬ responseë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

```jsx
app.get("/", (req, res) => {
  res.send(
    render(TodoList()) // HTML ë¬¸ìì—´ë¡œ ë³€í™˜
  );
});
```

ë³´í†µ í”„ë ˆì„ì›Œí¬ì—ì„œ ì œê³µí•˜ëŠ” SSR ê´€ë ¨ ì„œë“œíŒŒí‹° ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„, ìœ„ì™€ ê°™ì€ ë‚´ìš©ì„ ìˆ™ì§€í•˜ê³  ìˆì–´ì•¼ ì œëŒ€ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

### (4) SSRê³¼ CSR ë™ì‹œ ì ìš© (Hydration)

ì•ì„œ ë‹¤ë£¬ SSRì˜ ë¬¸ì œëŠ”, ë°”ë¡œ **CSRì´ ìƒëµ**ë˜ì—ˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ì¦‰, **ì´ë²¤íŠ¸ ë“±ë¡ê³¼ ê°™ì€ ë¸Œë¼ìš°ì €ì˜ ìˆœ ê¸°ëŠ¥ì´ ìƒëµ**ë˜ê³  ì˜¤ì§ **ì´ˆê¸° HTMLë§Œ ì¶œë ¥ëœ ìƒíƒœ**ì…ë‹ˆë‹¤.

![1.gif](/images/front/post/2021-10-01-vue-ssr/gif/1.gif)
*ì´ë²¤íŠ¸ê°€ ì‘ë™í•˜ì§€ ì•ŠìŒ*

ì œê°€ SSR ê´€ë ¨ ë¬¸ì„œë¥¼ ë³¼ ë•Œ ì œì¼ ë‹µë‹µí–ˆë˜ ê²ƒ ì¤‘ í•˜ë‚˜ê°€ ë°”ë¡œ **SSRê³¼ CSRì„ ë™ì‹œì— í•˜ëŠ” ë°©ë²•(Hydration)**ì— ëŒ€í•´ ì†Œê°œí•˜ëŠ” ë‚´ìš©ì´ ë¬´ì²™ ë¹ˆì•½í•˜ë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤. ë•ë¶„ì— ì‚½ì§ˆì„ êµ‰ì¥íˆ ë§ì´ í–ˆì—ˆì£  ğŸ˜‚

ì–´ì¨Œë“ , Vanilla JSë¡œ ì´ë¥¼ êµ¬í˜„í•´ë´…ì‹œë‹¤.

í´ë” êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
.
â”œâ”€ package.json
â”œâ”€ app.js                  # static ê´€ë ¨ ì½”ë“œ ì¶”ê°€
â””â”€ src
    â”œâ”€ main.js             # ë¸Œë¼ìš°ì €(HTML)ì— ì‚½ì…ë  ìŠ¤í¬ë¦½íŠ¸. ì¦‰, clientì˜ entry point
    â”œâ”€ components.js       # ì•ì„  ì½”ë“œì™€ ë™ì¼
    â”œâ”€ serverRenderer.js   # ê¸°ì¡´ì— render.js
    â””â”€ store.js            # ì´ì „ê³¼ ë™ì¼
```

#### 1) /app.js

ë¨¼ì € **static ê´€ë ¨ ì„¤ì •**ì„ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
import express from "express";
import { TodoList } from "./src/components.js";
import { serverRenderer } from "./src/ServerRenderer.js";

const app = express();

// static ê´€ë ¨ ì„¤ì • ì¶”ê°€
app.use("/src", express.static("./src"));

app.get("/", (req, res) => {
  res.send(
    serverRenderer(TodoList())
  );
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000');
})
```

#### 2) /src/serverRenderer.js

ê·¸ë¦¬ê³  ê¸°ì¡´ì— `render.js`ë¥¼ `serverRenderer.js`ë¡œ ì´ë¦„ì„ ë³€ê²½í•˜ê³ , script íƒœê·¸ë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.

```jsx
export const serverRenderer = (RootComponent) => `
  <!doctype html>
  <html lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>Server Side Rendering</title>
  </head>
  <body>
  <div id="app">${RootComponent}</div>
  
  <!-- csrì„ ìœ„í•œ script íƒœê·¸ ì¶”ê°€ -->
  <script src="./src/main.js" type="module"></script>
  <!-- / csrì„ ìœ„í•œ script íƒœê·¸ ì¶”ê°€ -->
  
  </body>
  </html>
`;
```

ì´ì „ê³¼ ë‹¬ë¼ì§„ ì ì€, `<script src="./src/main.js" type="module"></script>`ì´ ì¶”ê°€ëœ ìƒíƒœì…ë‹ˆë‹¤. ì¦‰, ë Œë”ë§ì´ ì™„ë£Œëœ ë‹¤ìŒì— **ë¸Œë¼ìš°ì €ì—ì„œ CSRì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡** ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

#### 3) /src/main.js

`main.js`ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ì‹¤í–‰í•˜ëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ entry pointì…ë‹ˆë‹¤.

```jsx
import { TodoList } from "./components.js";
import { store } from "./store.js";

export const render = () => {
  // ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
  const $app = document.querySelector('#app');
  $app.innerHTML = TodoList();

  // ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
  $app.querySelectorAll('li').forEach(el => {
    el.addEventListener('click', () => {
      const { id } = el.dataset;
      store.toggleActivation(store.state.todoItems.findIndex(v => v.id === Number(id)));
      render();
    })
  });
}

render();
```

ì´ëŸ¬í•œ ê³¼ì •ì„ í†µí•´ì„œ ë§Œë“¤ì–´ì§„ htmlì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![6.png](/images/front/post/2021-10-01-vue-ssr/6.png)

ê·¸ë¦¬ê³  ì´ë²¤íŠ¸ë„ ì •ìƒì ìœ¼ë¡œ ì˜ ë“±ë¡ëœ ìƒíƒœì…ë‹ˆë‹¤.

![2.gif](/images/front/post/2021-10-01-vue-ssr/gif/2.gif)

### (5) Router ì ìš©í•´ë³´ê¸°

ì‚¬ì‹¤ ì´ì •ë„ë§Œ ì†Œê°œí•´ë„ ì¶©ë¶„í•˜ì§€ë§Œ, ì‹¤ë¬´ì—ì„œëŠ” Routerë„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ê°„ë‹¨í•˜ê²Œ Routerê¹Œì§€ ì ìš©í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ì´ë²ˆì—” í´ë”êµ¬ì¡°ë¥¼ ìƒëµí•˜ê³ , í•„ìš”í•œ ì½”ë“œë§Œ ì–¸ê¸‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

#### 1) /app.js

```jsx
import express from "express";
import { App } from "./src/components.js";
import { serverRenderer } from "./src/ServerRenderer.js";

const app = express();

app.use("/src", express.static("./src"));

// pathê°€ `/`ì—ì„œ `/*`ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  routeì™€ ë§¤ì¹­í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
app.get("/*", (req, res) => {
  res.send(
    serverRenderer(
      // ê¸°ì¡´ì—ëŠ” TodoListë§Œ ë Œë”ë§í–ˆëŠ”ë°,
      // ì´ì œ App ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
      App({
        path: req.path, // ë Œë”ë§ì„ í•  ë•Œ path ì •ë³´ë¥¼ ê°™ì´ ë³´ëƒ…ë‹ˆë‹¤.
      })
    )
  );
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000');
})
```

#### 2) /src/components.js

```jsx
import { store } from "./store.js";

export const TodoList = () => `
  <ul>
    ${store.state.todoItems.map(({ id, content, activation }) => `
      <li data-id="${id}">
        <input type="checkbox" ${activation ? 'checked' : ''} />
        <span ${activation ? ' style="text-decoration: line-through;"' : ''}>${content}</span>
      </li>
    `).join('')}
  </ul>
`;

// pathì— ë”°ë¼ Renderingí•  Componentë¥¼ í•¸ë“¤ë§í•©ë‹ˆë‹¤.
const Router = (path) => {
  if (path === '/todo-list') {
    return TodoList();
  }

  // `/todo-list` ì™¸ì˜ pathëŠ” ì „ë¶€ Hello Worldë¥¼ ë Œë”ë§í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.
  return `Hello World`;
}

// headerì™€ footerë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
export const App = ({ path }) => {
  return `
    <header>
      <a href="/">SSR Tutorial</a>
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/todo-list">Todo List</a></li>
        </ul>
      </nav>
    </header>
    ${Router(path)}
    <footer>
      Copyright &copy; í™©ì¤€ì¼ All Right Reserved.
    </footer>
  `
}
```

~~ì‚¬ì‹¤ componentsë„ ë‹¤ì–‘í•œ ì½”ë“œë¡œ ë¶„í• í•  ìˆ˜ ìˆìœ¼ë‚˜, ê·€ì°®ê¸° ë•Œë¬¸ì— í•œ íŒŒì¼ì— ëª°ì•„ë†¨ìŠµë‹ˆë‹¤.~~

Routerê°€ ê±°ì°½í•œê²Œ ì•„ë‹ˆë¼ **pathì— ë”°ë¼ Component í•¸ë“¤ë§ ì •ë„ë§Œ** í•´ì£¼ë©´ ëœë‹µë‹ˆë‹¤. ë¬¼ë¡  Clientì—ì„œ SPAë¥¼ êµ¬ì„±í•  ë•ŒëŠ” ì´ë³´ë‹¤ ë” ë³µì¡í•œ ë¡œì§ì´ í•„ìš”í•©ë‹ˆë‹¤.

ê²°ê³¼ë¬¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![3.gif](/images/front/post/2021-10-01-vue-ssr/gif/3.gif)

### (6) Serverì—ì„œ ë§Œë“¤ì–´ì§„ ë³€ìˆ˜ë¥¼ Clientì— ì „ë‹¬í•˜ê¸°

ì´ëŒ€ë¡œ ëë‚´ê¸°ì—ëŠ” ë˜ ì•„ì‰¬ì›Œì„œ, ì´ë²ˆì—ëŠ” Storeì˜ ë‚´ìš©ì„ clientì— ì–´ë–»ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

**ê¸°ì¡´ì—ëŠ” clientì—ì„œ ì‘ì—…í•œ ë‚´ìš©ì´ server ë°˜ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

![4.gif](/images/front/post/2021-10-01-vue-ssr/gif/4.gif)

ê·¸ë˜ì„œ Clientì—ì„œ ì‘ì—…í•œ ë‚´ìš©ì„ ë°”ë¡œ Serverì—ì„œ ë°˜ì˜í•˜ê³ , ë°˜ëŒ€ë¡œ Serverì— ìˆëŠ” ë‚´ìš©ì„ Clientì— ë°”ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
ì¦‰, **ë™ê¸°í™” ì‘ì—…**ì´ í•„ìš”í•©ë‹ˆë‹¤.

#### 1) /app.js

```jsx
import express from "express";
import { App } from "./src/components.js";
import { serverRenderer } from "./src/ServerRenderer.js";
import { store } from "./src/store.js";

const app = express();

app.use(express.json());
app.use("/src", express.static("./src"));

// stateì˜ ê°’ì„ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” apië¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
app.put('/api/state', (req, res) => {
  store.hydration(req.body);
  res.status(204).send();
})

app.get("/*", (req, res) => {
  res.send(
    // stateë¥¼ Rendering í•  ë•Œ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.
    serverRenderer(App({ path: req.path }), store.state)
  );
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000');
})
```

- `/api/state` endpointë¥¼ í†µí•´ì„œ **serverì—ì„œ ê´€ë¦¬í•´ì£¼ëŠ” ë°ì´í„°ë¥¼ ë³€ê²½**í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
- ê·¸ë¦¬ê³  **ë Œë”ë§ ì‹œì ì— stateë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë„ë¡ ì‘ì—…**ì´ í•„ìš”í•©ë‹ˆë‹¤.

#### 2) /src/serverRenderer.js

ì•ì„  ë‚´ìš© ì²˜ëŸ¼, ë Œë”ë§ ì‹œì ì— stateë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•´ì„  **window ê°ì²´ë¥¼ í™œìš©**í•´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, HTML ë‚´ë¶€ì—ì„œ **ì§ì ‘ì ìœ¼ë¡œ stateë¥¼ ì¶œë ¥**í•´ì¤˜ì•¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
export const serverRenderer = (RootComponent, state) => `
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Server Side Rendering</title>
  <script>
    window.state = ${JSON.stringify(state)}
  </script>
</head>
<body>
<div id="app">${RootComponent}</div>
<script src="./src/main.js" type="module"></script>
</body>
</html>
`;
```

#### 3) /src/store.js

- ë¸Œë¼ìš°ì €ì—ì„œ `globalThis`ëŠ” `window` ê°ì²´ë¥¼ ê°€ë¥´í‚µë‹ˆë‹¤.
- Node.jsì—ì„œ `globalThis`ëŠ” `global`ê°ì²´ë¥¼ ê°€ë¥´í‚µë‹ˆë‹¤.

ì¦‰, **globalThisë¥¼ ì‚¬ìš©í•˜ë©´ ëŸ°íƒ€ì„ í™˜ê²½ê³¼ ê´€ê³„ì—†ì´ ì „ì—­ë³€ìˆ˜ë¥¼ ì‚¬ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
export const store = {
  // windowë¥¼ ì§ì ‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ server sideì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
  // ê·¸ë˜ì„œ ì´ë ‡ê²Œ globalThisë¥¼ í†µí•´ì„œ ë³€ìˆ˜ë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.
  state: globalThis.state || {
    todoItems: [
      { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
      { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
      { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
    ],
  },

  // ì´ ë©”ì†Œë“œëŠ” server sideì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
  hydration (state) {
    this.state = state;
  },

  // setStateë¥¼ ì‹¤í–‰í•˜ë©´ serverì—ì„œ ê´€ë¦¬ì¤‘ì¸ stateì—ë„ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…í•©ë‹ˆë‹¤.
  setState (newState) {
    this.state = { ...this.state, ...newState  };
    fetch('/api/state', {
      method: 'put',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify(this.state),
    })
  },
  toggleActivation (index) {
    const todoItems = [ ...this.state.todoItems ];
    todoItems[index].activation = !todoItems[index].activation;
    this.setState({ todoItems });
  }
};
```

ìœ„ì˜ ì½”ë“œëŠ” ì•ì„œ `app.js`ì—ì„œ ì‘ì„±í•œ `PUT /api/state`ê³¼ ìƒí˜¸ì‘ìš©ì„ í•©ë‹ˆë‹¤.

```jsx
app.put('/api/state', (req, res) => {
  store.hydration(req.body); // storeì˜ stateë¥¼ req.bodyë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
  res.status(204).send();
})
```

ê²°ê³¼ë¬¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![5.gif](/images/front/post/2021-10-01-vue-ssr/gif/5.gif)
*ìƒˆë¡œê³ ì¹¨ì„ í•´ë„ ë³€ê²½ëœ ë‚´ìš©ì´ ë³´ì¡´ë©ë‹ˆë‹¤*

***

ì—¬ê¸°ê¹Œì§€ `Vanilla Javascript`ë¥¼ ì´ìš©í•˜ì—¬ `Server Side Rendering`ì„ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤.
ìœ„ì—ì„œ ë‹¤ë£¬ ëª¨ë“  ì½”ë“œëŠ” [ì´ ì €ì¥ì†Œ](https://github.com/JunilHwang/simple-ssr)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

***

## 3. Vue SSR

ì•ì„  ê³¼ì •ì„ í†µí•´ì„œ ìš°ë¦¬ëŠ” SSRì„ í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì´ë¥¼ í† ëŒ€ë¡œ **Vue.jsì—ì„œëŠ” ì–´ë–»ê²Œ SSRì„ ì ìš©í•˜ëŠ”ì§€** ì‚´í´ë³´ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

> í˜„ì¬ ì„¹ì…˜ì— ì‚¬ìš©ëœ ì½”ë“œëŠ” [ì´ ì €ì¥ì†Œ](https://github.com/JunilHwang/simple-vue-ssr)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### (1) í”„ë¡œì íŠ¸ êµ¬ì„±

ë¨¼ì € Vue Projectë¥¼ êµ¬ì„±í•´ì•¼í•©ë‹ˆë‹¤. ê°„ë‹¨í•˜ê²Œ [vue-cli](https://cli.vuejs.org/guide/)ë¡œ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•´ë´…ì‹œë‹¤.

í´ë” êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```bash
vue-simple-ssr
â”œâ”€ client   # vue í”„ë¡œì íŠ¸
â””â”€ server   # express í”„ë¡œì íŠ¸
```

**clientì—ì„œ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•˜ê³ , buildë¥¼ í•˜ë©´ serverì— ì •ì íŒŒì¼ì´ ìƒì„±ë˜ëŠ” í˜•íƒœ**ì…ë‹ˆë‹¤. ì§€ê¸ˆì€ ë³„ë¡œ ì™€ë‹¿ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì¼ë‹¨ ì½”ë“œë¥¼ í†µí•´ì„œ ì‚´í´ë´…ì‹œë‹¤.

```bash
# vue clië¥¼ ì „ì—­ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼í•©ë‹ˆë‹¤.
> npm install -g @vue/cli

# í’€ìŠ¤íƒìœ¼ë¡œ ì‘ì—…í•´ì•¼í•˜ê¸° ë•Œë¬¸ì—, ìµœìƒìœ„ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±í•´ì•¼í•©ë‹ˆë‹¤.
> mkdir vue-simple-ssr

# í´ë”ë¡œ ì´ë™ í›„ vue projectë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
> cd vue-simple-ssr
> vue create client

#################################################################
# ë³¸ë¬¸ì— ì‚¬ìš©ë˜ëŠ” í™˜ê²½ì€ babel + vue2 + vuex + vue-router ì…ë‹ˆë‹¤ #
#################################################################

# ì„œë²„ í™˜ê²½ë„ êµ¬ì„±í•©ë‹ˆë‹¤.
# ì¼ë‹¨ expressë§Œ ì„¤ì¹˜í•˜ê³ , ìì„¸í•œ ì½”ë“œëŠ” ì„œë²„ì‚¬ì´ë“œ ì„¹ì…˜ì—ì„œ ë‹¤ë£° ì˜ˆì •ì…ë‹ˆë‹¤.
> cd ..
> mkdir server
> yarn init -y
> npm install express
```

ì•„ë§ˆ vue.jsì˜ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ êµ¬ì„±ë  ê²ƒì…ë‹ˆë‹¤. ì•ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ `vue 2.6` + `vuex 3` + `vue-router 3` + `babel` ë“±ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

> `Vue 3`ì— ëŒ€í•œ SSRì€ ê·¸ëƒ¥ [ê³µì‹ë¬¸ì„œ](https://v3.vuejs.org/guide/ssr/introduction.html) ë³´ì‹œëŠ”ê±¸ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ê³µì‹ë¬¸ì„œì— ì„¤ëª…ì´ ë””í…Œì¼í•˜ê²Œ ë˜ì–´ìˆë‹µë‹ˆë‹¤!

```json
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build --no-clean"
  },
  "dependencies": {
    "core-js": "^3.6.5",
    "vue": "^2.6.11",
    "vue-router": "^3.2.0"
    "vuex": "^3.4.0"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "~4.5.0",
    "@vue/cli-plugin-router": "~4.5.0",
    "@vue/cli-plugin-vuex": "~4.5.0",
    "@vue/cli-service": "~4.5.0",
    "cross-env": "^7.0.3",
    "vue-template-compiler": "^2.6.11"
  },
  "browserslist": [
    "> 1%",
    "last 2 versions",
    "not dead"
  ]
}
```

### (2) ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°

ì•ì„  ì‹¤ìŠµ ì²˜ëŸ¼ ê°„ë‹¨í•œ todoListë¥¼ êµ¬ì„±í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì²˜ìŒì— êµ¬ì„±ëœ í”„ë¡œì íŠ¸ì—ì„œ **About.vueë¥¼ ì‚­ì œ**í•˜ê³ , **TodoList.vueë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.**

```bash
client
â”œâ”€ package.json
â”œâ”€ babel.config.js        # babel ì„¤ì •ì…ë‹ˆë‹¤. ìƒì„±ëœ í˜•íƒœ ê·¸ëŒ€ë¡œ ë‘ë©´ ë©ë‹ˆë‹¤.
â”œâ”€ public                 # static íŒŒì¼ 
â””â”€ src
    â”œâ”€ main.js            # Vue Applicationì˜ entry point
    â”œâ”€ App.vue            # Vue Applicaitonì˜ Root Instance
    â”œâ”€ router/index.js    # router ì„¤ì • íŒŒì¼
    â”œâ”€ store/index.js     # store ì„¤ì • íŒŒì¼
    â”œâ”€ assets             # css, image ë“±ì˜ assets
    â”œâ”€ components         # applicationì—ì„œ ì‚¬ìš©ë˜ëŠ” componentë¥¼ ëª¨ì•„ë‘ 
    â””â”€ views              # routerë¡œ ì‚¬ìš©ë˜ëŠ” componentë¥¼ ëª¨ì•„ë‘ 
```

#### 1) /src/main.js

main.jsëŠ” ë§Œë“¤ì–´ì§„ ìƒíƒœ ê·¸ëŒ€ë¡œ ë‘ë©´ ë©ë‹ˆë‹¤. ê·¸ë˜ë„ **entry point**ì´ê¸° ë•Œë¬¸ì— ì½”ë“œë§Œ ì†Œê°œí•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import App from './App.vue';
import router from './router'; // clië¡œ ë§Œë“¤ì–´ì§„ router
import store from './store'; // clië¡œ ë§Œë“¤ì–´ì§„ store

Vue.config.productionTip = false;

// Vue Appì„ ë§Œë“­ë‹ˆë‹¤.
new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app');
```

#### 2) /src/store/index.js

ì¼ë‹¨ TodoListë¥¼ ë§Œë“¤ ë•Œ í•„ìš”í•œ **stateë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê³¼ì •**ì´ í•„ìš”í•©ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

export default new Vuex.Store({
  state: {
    todoItems: [
      { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
      { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
      { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
    ],
  },
  mutations: {
    SET_TODO_ITEMS (state, todoItems) {
      state.todoItems = todoItems;
    }
  },
});
```

#### 3) /src/views/TodoList.vue

ì•ì„œ ì‘ì„±í•œ store ì½”ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ TodoListë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤. ì‚¬ì‹¤ ì½”ë“œëŠ” vanilla js ì„¹ì…˜ì—ì„œ ì‘ì„±í•œ ê²ƒê³¼ í¬ê²Œ ë‹¤ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.

```html
<template>
  <ul>
    <li
      v-for="{ id, content, activation } in todoItems"
      @click="toggle(id)"
    >
      <input type="checkbox" :checked="activation" />
      <span
        :style="{
          textDecoration: activation ? 'line-through' : 'none'
        }"
        v-html="content"
      />
    </li>
  </ul>
</template>

<script>
import { mapState, mapMutations } from "vuex";

const pageTitle = "TodoList | Vue SSR";

export default {
  name: "TodoList",

  computed: {
    ...mapState(['todoItems']),
  },

  methods: {
    ...mapMutations(['SET_TODO_ITEMS']),

    toggle (id) {
      const todoItems = [ ...this.todoItems ];
      const selectedItem = todoItems.find(v => v.id === id);
      selectedItem.activation = !selectedItem.activation;
      this.SET_TODO_ITEMS(todoItems);
    }
  },
}
</script>
```

1. /src/router/index.js

ê·¸ë¦¬ê³  ìœ„ì—ì„œ ì‘ì„±í•œ TodoListë¥¼ routerì— ë“±ë¡í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import VueRouter from 'vue-router';

import Home from "../views/Home.vue";
import TodoList from "../views/TodoList";

Vue.use(VueRouter);

export default new VueRouter({
  mode: 'history',
  base: process.env.BASE_URL,
  routes: [
    {
      path: '/',
      name: 'Home',
      component: Home
    },
    {
      path: '/todo-list',
      name: 'TodoList',
      component: TodoList,
    }
  ]
});
```

1. /src/App.vue

ê¸°ì¡´ì— ìˆë˜ `/about`ë©”ë‰´ë¥¼ ì œê±°í•˜ê³ , `/todo-list`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```jsx
<template>
  <div id="app">
    <div id="nav">
      <router-link to="/">Home</router-link> |
      <router-link to="/todo-list">TodoList</router-link>
    </div>
    <router-view/>
  </div>
</template>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  color: #2c3e50;
  padding: 10px;
}

#nav {
  margin-bottom: 20px;
}

#nav a {
  font-weight: bold;
  color: #2c3e50;
}

#nav a.router-link-exact-active {
  color: #42b983;
}
</style>
```

ì´ì œ ê°œë°œ ì„œë²„ë¥¼ ë„ì›Œì„œ ì˜ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•´ë´ì•¼ í•©ë‹ˆë‹¤.

```bash
> yarn serve
```

![6.gif](/images/front/post/2021-10-01-vue-ssr/gif/6.gif)

### (3) SSR ê´€ë ¨ ì‘ì—… ì§„í–‰

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ SSRì„ ìœ„í•œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

1. ssr ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜
2. store, router ì½”ë“œë¥¼ ssrì— ì í•©í•˜ê²Œ ë³€ê²½
3. App.vueì— idê°’ í™•ì¸
4. main-ssr.js ì¶”ê°€
  - server side renderingì˜ entry point
5. vue.config.js ì¶”ê°€
  - server side renderingì— í•„ìš”í•œ bundle fileì„ ë§Œë“¤ìˆ˜ ìˆë„ë¡ ì„¤ì • ì¶”ê°€
6. npm script ì‘ì„±

ë¨¼ì € í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
# vue ssrì„ ë„ì™€ì£¼ëŠ” ì„œë“œíŒŒí‹° ë„êµ¬
> yarn add vue-server-renderer

# ssr ì‘ì—…ì‹œ ë¶ˆí•„ìš”í•œ ë‚´ìš©ì„ bundleí•˜ì§€ ì•Šë„ë¡ í•´ì£¼ëŠ” ì„œë“œíŒŒí‹°
> yarn add webpack-node-externals

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ ìœ„í•´ì„œ cross-env ì„¤ì¹˜
> yarn add -D cross-env
```

ê·¸ë¦¬ê³  `vue.config.js`ë¥¼ ë§Œë“  í›„ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

```jsx
const VueSSRServerPlugin = require('vue-server-renderer/server-plugin');
const nodeExternals = require('webpack-node-externals');
const isSSR = Boolean(process.env.SSR);

module.exports = {
  // serverì—ì„œ renderingì„ í•  ë•Œ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—,
  // buildëœ íŒŒì¼ì´ serverìª½ ë””ë ‰í† ë¦¬ì— ìœ„ì¹˜ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.
  outputDir: '../server/public',

  pages: {
    // ssrë¡œ ë¹Œë“œí•  ë• ë‹¤ë¥¸ main-ssr.jsë¥¼ entryë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
    index: `src/main${isSSR ? '-ssr' : '' }.js`,
  },

  chainWebpack: config => {
    // ì¼ë‹¨ ssrë¡œ ë¹Œë“œí•˜ëŠ” ê²½ìš°ì—ë§Œ ì„¤ì •ì„ ì ìš©í•´ì•¼í•©ë‹ˆë‹¤.
    if (!isSSR) return;

    config
      // webpackì´ node.jsì— ì í•©í•œ ë°©ì‹ìœ¼ë¡œ dynamic importë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°
      // Vueë¥¼ ì»´íŒŒì¼í•  ë•Œ `vue-loader`ê°€ ì„œë²„ ì§€í–¥ ì½”ë“œë¥¼ ë‚´ë³´ë‚´ë„ë¡ í•©ë‹ˆë‹¤.
      .target('node')
      
      // ê³µì‹ë¬¸ì„œì—ëŠ” ë‚˜ì™€ìˆì§€ ì•Šì§€ë§Œ, splitChunksë¥¼ ì œê±°í•´ì•¼ ì •ìƒì ìœ¼ë¡œ ë¹Œë“œë©ë‹ˆë‹¤.
      // server sideì—ì„œëŠ” ì–´ì°¨í”¼ jsë¥¼ splití•˜ì—¬ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
      // ì´ ì„¤ì •ì´ ì œì™¸ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
      // Error: Server-side bundle should have one single entry file.
      .optimization
        .delete('splitChunks')
        .end()
      
      // commonjs ë°©ì‹ì˜ module êµ¬ë¬¸ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
      .output
        .libraryTarget('commonjs2')
        .end()
      
      // cssì™€ scssì—ëŠ” ë²ˆë“¤í•  ë•Œ í¬í•¨í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
      // ê·¸ë¦¬ê³  ê³µì‹ë¬¸ì„œì—ëŠ” `whitelist`ë¡œ ë‚˜ì™€ìˆëŠ”ë°,
      // `allowlist`ë¡œ í•´ì•¼ ì •ìƒì‘ë™ í•©ë‹ˆë‹¤. (depatchedë¨)
      .externals(nodeExternals({ allowlist: /\.css|\.scss$/ }))
      
      // ì´ í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ì„œ server sideì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ bundleì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
      .plugin('ssr').use(new VueSSRServerPlugin());
  },
}
```

ê·¸ë¦¬ê³  `/src/main-ssr.js`ë¥¼ ì¶”ê°€í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

1. ë§Œì•½ì— **routerì™€ storeê°€ ì—†ë‹¤ë©´** ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ë  ê²ƒì…ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import App from './App.vue';

export default function () {
  return new Vue({
    render: h => h(App);
  });
}
```

1. ê·¸ëŸ°ë° ë³´í†µ routerì™€ store ëª¨ë‘ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import App from './App.vue';

// routerì™€ storeê°€ instanceë¥¼ ë°˜í™˜í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼,
// instanceë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•´ì•¼í•©ë‹ˆë‹¤.
// csrì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ë Œë”ë§ ë˜ê¸° ë•Œë¬¸ì— routerì™€ storeê°€ 1ê°œì”©ë§Œ í•„ìš”í•©ë‹ˆë‹¤.
// ê·¸ëŸ°ë° ssrì€ ë‹¤ìˆ˜ì˜ ì‚¬ìš©ìë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ê¸° ë•Œë¬¸ì—
// ì‚¬ìš©ìë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ routerì™€ storeê°€ í•„ìš”í•©ë‹ˆë‹¤.
// ê·¸ë˜ì„œ routerì™€ storeë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ë„ë¡ ë§Œë“¤ì–´ì•¼í•©ë‹ˆë‹¤.
import createRouter from './router';
import createStore from './store';

// 1. ì´ íŒŒì¼ì„ entry pointë¡œ í•˜ì—¬ server sideì—ì„œ ì‹¤í–‰í•  scriptë¥¼ ë²ˆë“¤ë§í•©ë‹ˆë‹¤.
// 2. Vue applicationì„ ë§Œë“¤ì–´ë‚´ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
// 3. Promiseë¥¼ ë°˜í™˜í•  ìˆ˜ë„ ìˆìœ¼ë©°, ë‹¨ìˆœí•˜ê²Œ Vue instanceë¥¼ ë°˜í™˜í•´ë„ ë¬´ê´€í•©ë‹ˆë‹¤.
// 4. serverì—ì„œ renderingì— í•„ìš”í•œ contextë¥¼ ë§¤ê°œë³€ìˆ˜ ê±´ë‚´ì¤ë‹ˆë‹¤.
export default (context) => new Promise(async (resolve, reject) => {

  const router = createRouter();
  const store = createStore();
  const { url } = context;
  
  // serverì—ì„œ ë³´ë‚´ì¤€ urlì„ ê¸°ì¤€ìœ¼ë¡œ routerë¥¼ ë³€ê²½í•˜ê³ ,
  // í•´ë‹¹ routerë¥¼ ê¸°ì¤€ìœ¼ë¡œ appì„ renderingí•˜ì—¬ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
  await router.push(url);

  // routerì— ë°˜ì˜ì´ ëœ ì‹œì ì— App instanceë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•©ë‹ˆë‹¤.
  // ê·¸ë˜ì„œ Promiseê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.
  router.onReady(() => resolve(
    new Vue({
      router,
      store,
      render: h => h(App)
    }))
  );
})
```

ì£¼ì„ì—ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ storeì™€ router ë˜í•œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

1. /src/router/index.js

```jsx
import Vue from 'vue';
import VueRouter from 'vue-router';

import Home from "../views/Home.vue";
import TodoList from "../views/TodoList";

Vue.use(VueRouter);

// createRouterë¥¼ ì‹¤í–‰í•˜ë©´, router instanceë¥¼ ë°˜í™˜í•˜ë„ë¡ ì‘ì„±í•´ì•¼í•©ë‹ˆë‹¤.
// ì‚¬ìš©ì(client)ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ Routerë¥¼ ê°€ì§€ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
export default function createRouter () {
  return new VueRouter({
    mode: 'history',
    base: process.env.BASE_URL,
    routes: [
      {
        path: '/',
        name: 'Home',
        component: Home
      },
      {
        path: '/todo-list',
        name: 'TodoList',
        component: TodoList,
      }
    ]
  });
}
```

1. /src/store/index.js

```jsx
import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

// createStoreë¥¼ ì‹¤í–‰í•˜ë©´, store instanceë¥¼ ë°˜í™˜í•˜ë„ë¡ ì‘ì„±í•©ë‹ˆë‹¤.
// ì‚¬ìš©ì(client)ë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ Storeë¥¼ ê°€ì§€ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
export default function createStore () {
  return new Vuex.Store({
    state: {
      todoItems: [
        { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
        { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: false },
        { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
      ],
    },
    mutations: {
      SET_TODO_ITEMS (state, todoItems) {
        state.todoItems = todoItems;
      }
    },
  })
};
```

ê·¸ë¦¬ê³  ë³´í†µ cliì„ ì´ìš©í•˜ì—¬ í”„ë¡œì íŠ¸ê°€ ì´ˆê¸°í™” ë˜ì—ˆë‹¤ë©´ `/src/App.vue`ì˜ root íƒœê·¸ì— idê°’ì´ ì§€ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë´ì•¼ í•©ë‹ˆë‹¤. ë§Œì•½ì— idê°€ ì œëŒ€ë¡œ ì§€ì •ë˜ì§€ ì•Šì•˜ë‹¤ë©´, ssrì„ í–ˆì„ ë•Œ idê°€ ëˆ„ë½ë˜ê¸° ë•Œë¬¸ì— **CSRì„ í•  ë•Œ root tagë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ì„œ ë¬¸ì œ**ê°€ ë©ë‹ˆë‹¤.

```html
<template>
  <div id="app">
    <div id="nav">
      <router-link to="/">Home</router-link> |
      <router-link to="/todo-list">TodoList</router-link>
    </div>
    <router-view/>
  </div>
</template>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  color: #2c3e50;
  padding: 10px;
}

#nav {
  margin-bottom: 20px;
}

#nav a {
  font-weight: bold;
  color: #2c3e50;
}

#nav a.router-link-exact-active {
  color: #42b983;
}
</style>
```

ì´ë ‡ê²Œ `vue.config.js`ë¥¼ ì‘ì„±í–ˆë‹¤ë©´, ì´ì œ `package.json`ì— `npm script`ë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

```json
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    // ê¸°ì¡´ì— `build`ë¥¼ `build:csr`ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
    "build:csr": "vue-cli-service build",
    // `build:ssr`ì„ ì¶”ê°€í•˜ê³ , SSRì„ ìœ„í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
    "build:ssr": "cross-env SSR=1 vue-cli-service build"
  },
  "dependencies": {
    "core-js": "^3.6.5",
    "vue": "^2.6.11",
    "vue-router": "^3.2.0",
    "vue-server-renderer": "^2.6.14",
    "vuex": "^3.4.0",
    "webpack-node-externals": "^3.0.0"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "~4.5.0",
    "@vue/cli-plugin-router": "~4.5.0",
    "@vue/cli-plugin-vuex": "~4.5.0",
    "@vue/cli-service": "~4.5.0",
    "cross-env": "^7.0.3",
    "vue-template-compiler": "^2.6.11"
  },
  "browserslist": [
    "> 1%",
    "last 2 versions",
    "not dead"
  ]
}
```

npm scriptë„ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì´ì œ buildë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤.

```bash
> yarn build:ssr
```

ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆë‹¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ **bundle íŒŒì¼(vue-ssr-server-bundle.json)**ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

![7.png](/images/front/post/2021-10-01-vue-ssr/7.png)

![8.png](/images/front/post/2021-10-01-vue-ssr/8.png)

íŒŒì¼ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ bundlingëœ scriptì…ë‹ˆë‹¤.

![9.png](/images/front/post/2021-10-01-vue-ssr/9.png)

ì´ íŒŒì¼ì„ serverì—ì„œ ë¶ˆëŸ¬ì™€ì„œ renderë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### (4) ì„œë²„ ì‚¬ì´ë“œ ì‘ì—…í•˜ê¸°

ì´ì œ serverìª½ ì½”ë“œë¥¼ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. ì¼ë‹¨, server í”„ë¡œì íŠ¸ì— `vue-server-renderer` íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

```bash
# server í´ë”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
> cd ../server

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
> yarn add vue-server-renderer
```

ê·¸ë¦¬ê³  `/server/app.js`ì— ssr ê´€ë ¨ ì½”ë“œë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
// express applicationì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
const express = require("express");
const app = express();

// ssrì— í•„ìš”í•œ íŒ¨í‚¤ì§€ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
const { createBundleRenderer } = require("vue-server-renderer");

// SSRë¡œ ë§Œë“¤ì–´ì§„ htmlì´ <!--vue-ssr-outlet--> ìœ„ì¹˜ì— ì‚½ì…ë©ë‹ˆë‹¤.
const template = `
  <!DOCTYPE html>
  <html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Vue Simple SSR</title>
  </head>
  <body>
  <!--vue-ssr-outlet-->
  </body>
  </html>
`;

// templateê³¼ bundleëœ íŒŒì¼ì„ ì´ìš©í•˜ì—¬ rendererë¥¼ ë§Œë“­ë‹ˆë‹¤.
const renderer = createBundleRenderer(
  // main-ssr.jsë¥¼ ê¸°ì¤€ìœ¼ë¡œ bundleëœ íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ ì‹¤í–‰í•©ë‹ˆë‹¤.
  require('./public/vue-ssr-server-bundle.json'),

  // ë Œë”ë§ëœ ì½”ë“œëŠ” templateì˜ <!--vue-ssr-outlet--> ìœ„ì¹˜ì— ì‚½ì…ë©ë‹ˆë‹¤.
  { template }
);

// ëª¨ë“  í˜ì´ì§€ì— ëŒ€í•´ ë§¤ì¹­í•©ë‹ˆë‹¤.
app.get("/*", async ({ url }, res) => {
  // renderToStringì— ë„˜ê²¨ì§€ëŠ” íŒŒë¼ë¯¸í„°ê°€ contextì…ë‹ˆë‹¤.
  // ì¦‰, renderToStringì´ main-ssr.jsë¥¼ ì‹¤í–‰í•˜ë©° ë°˜í™˜í•˜ëŠ” ê²ƒì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  res.send(await renderer.renderToString({ url }));
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000')
})
```

![10.png](/images/front/post/2021-10-01-vue-ssr/10.png)

ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![7.gif](/images/front/post/2021-10-01-vue-ssr/gif/7.gif)

ìœ„ì—ì„œ í™•ì¸í•œ ê²ƒ ì²˜ëŸ¼, ì§€ê¸ˆì€ ì˜¤ì§ `Server Side Rendering`ë§Œ ì‹¤í–‰ëœ ìƒíƒœì…ë‹ˆë‹¤.

ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

- styleì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ì‚½ì…ëœ scriptê°€ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ
  - eventê°€ ë“±ë¡ë˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤.
  - ë§í¬ë¥¼ ëˆ„ë¥´ë©´ í˜ì´ì§€ ì´ë™(ìƒˆë¡œê³ ì¹¨)ì´ ë©ë‹ˆë‹¤.
  - ì¦‰, spaê°€ ì•„ë‹ˆë¼ mpa ë°©ì‹ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ **CSR ì½”ë“œë¥¼ buildí•˜ê³ , SSR templateì— ì—°ë™í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…**ì´ í•„ìš”í•©ë‹ˆë‹¤.

### (5) CSR ê´€ë ¨ ì‘ì—… ì¶”ê°€í•˜ê¸°

[ê³µì‹ë¬¸ì„œ](https://ssr.vuejs.org/guide/build-config.html#client-config)ì—ì„œ ì•ˆë‚´í•˜ê³  ìˆëŠ” ë°©ë²•ì€ `client-manifest`ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. manifestë¥¼ ì´ìš©í•˜ì—¬ SSR ì‹œì ì— ì–´ë–¤ scriptì™€ styleì„ ê°€ì ¸ì™€ì•¼ í•˜ëŠ”ì§€ ëª…ì‹œí•˜ëŠ”ê±°ì£ . ë§ˆì°¬ê°€ì§€ë¡œ ì½”ë“œë¥¼ í†µí•´ì„œ ì‚´í´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

ë¨¼ì € CSR ë¹Œë“œë¥¼ ìœ„í•´ì„œ `vue.config.js` íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
const VueSSRServerPlugin = require('vue-server-renderer/server-plugin');
const nodeExternals = require('webpack-node-externals');
const isSSR = Boolean(process.env.SSR);

// client í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.
const VueSSRClientPlugin = require('vue-server-renderer/client-plugin');

// production ëª¨ë“œì¼ ë•Œë§Œ, ì¦‰, ë¹Œë“œë¥¼ í•  ë•Œë§Œ ì¶”ê°€ ì„¤ì •ì´ ë¶™ë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.
const isProduction = process.env.NODE_ENV === 'production';

module.exports = {
  outputDir: '../server/public',
  pages: {
    index: {
      entry: `src/main${isSSR ? '-ssr' : '' }.js`,
      template: 'public/index.html',

      // ë¹Œë“œë¥¼ í•  ë• /server/template/index.htmlì„ ìƒì„±í•˜ê³ ,
      // ê°œë°œì„œë²„ë¥¼ ì‹¤í–‰í•  ë• /client/public/index.htmlì„ ì½ì–´ì˜¬ ìˆ˜ ìˆë„ë¡
      // í•¸ë“¤ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.
      filename: isProduction ? '../template/index.html' : 'index.html',
    }
  },

  chainWebpack: config => {
    // ë¹Œë“œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ë©´ ì¶”ê°€ ì„¤ì •ì„ í•  í•„ìš”ê°€ ì—†ìœ¼ë¯€ë¡œ ë°”ë¡œ return í•©ë‹ˆë‹¤.
    if (!isProduction) return;

    // CSR ê´€ë ¨ ë¹Œë“œ ì„¤ì •ì…ë‹ˆë‹¤.
    if (!isSSR) {

      return config
              // í•œ ê°œì˜ bundle íŒŒì¼ì„ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹Œ,
              // ì—¬ëŸ¬ ê°œì˜ íŒŒì¼ë¡œ ë¶„í• í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
              .optimization
                .splitChunks({ name: "manifest", minChunks: Infinity, })
                .end()
              // ì´ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ì—¬ csrì„ ìœ„í•œ client manifestë¥¼ ë§Œë“¤ì–´ëƒ…ë‹ˆë‹¤.
              .plugin('ssr').use(new VueSSRClientPlugin())
    }

    // SSR ê´€ë ¨ ë¹Œë“œ ì„¤ì •
    config
      .target('node')
      .optimization
        .delete('splitChunks')
        .end()
      .output
        .libraryTarget('commonjs2')
        .end()
      .externals(nodeExternals({ allowlist: /\.css|\.scss$/ }))
      .plugin('ssr').use(new VueSSRServerPlugin());
  },
}
```

ê·¸ë¦¬ê³  `package.json`ì— csr buildë¥¼ ìœ„í•œ npm scriptë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

```json
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    // csr ë¹Œë“œì™€ ssr ë¹Œë“œë¥¼ ë™ì‹œì— í•  ìˆ˜ ìˆëŠ” ëª…ë ¹ì…ë‹ˆë‹¤.
    // csr ë¹Œë“œì‹œì—ëŠ” public í´ë”ë¥¼ ì§€ì›Œì£¼ê³ ,
    // ssr ë¹Œë“œì‹œì—ëŠ” `--no-clean` ì˜µì…˜ì„ í†µí•´ì„œ public í´ë”ë¥¼ ë³´ì¡´í•˜ë„ë¡ í•©ë‹ˆë‹¤.
    "build:all": "cross-env NODE_ENV=production vue-cli-service build && cross-env NODE_ENV=production SSR=1 vue-cli-service build --no-clean",

    // ssr ì‹œì ì—ë„ NODE_ENVë¥¼ productionìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    "build:ssr": "cross-env NODE_ENV=production SSR=1 vue-cli-service build",
    
    // csr ë¹Œë“œë¥¼ ìœ„í•œ ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤. `NODE_ENV=production` ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
    "build:csr": "cross-env NODE_ENV=production vue-cli-service build"
  },
  "dependencies": {
    "axios": "^0.21.4",
    "core-js": "^3.6.5",
    "vue": "^2.6.11",
    "vue-router": "^3.2.0",
    "vue-server-renderer": "^2.6.14",
    "vuex": "^3.4.0",
    "webpack-node-externals": "^3.0.0"
  },
  "devDependencies": {
    "@vue/cli-plugin-babel": "~4.5.0",
    "@vue/cli-plugin-router": "~4.5.0",
    "@vue/cli-plugin-vuex": "~4.5.0",
    "@vue/cli-service": "~4.5.0",
    "cross-env": "^7.0.3",
    "vue-template-compiler": "^2.6.11"
  },
  "browserslist": [
    "> 1%",
    "last 2 versions",
    "not dead"
  ]
}
```

ìœ„ì—ì„œ ìœ ì˜ê¹Šê²Œ ë´ì•¼ í•˜ëŠ” ë¶€ë¶„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- `no-clean` ì˜µì…˜
  - buildë¥¼ í•  ë•Œ output í´ë”ë¥¼ ì‚­ì œí•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
  - csrì„ ë¹Œë“œí•  ë•ŒëŠ” output í´ë”ë¥¼ ì‚­ì œí•˜ê³ , ssrì„ ë¹Œë“œí•  ë• output í´ë”ë¥¼ ë³´ì¡´í•´ì•¼í•©ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ csr buildë§Œ ìš°ì„  ì‹¤í–‰í•´ë´…ì‹œë‹¤.

```bash
> yarn build:csr
```

- ë¨¼ì € csr ë¹Œë“œë§Œ í–ˆì„ ë• ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ outputì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

  ![11.png](/images/front/post/2021-10-01-vue-ssr/11.png)

- ì‚¬ì§„ì—ì„œ ë³´ì—¬ì§€ëŠ” ê²ƒ ì²˜ëŸ¼ `vue-ssr-client-manifest.json`ì´ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- manifest íŒŒì¼ì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ csrì— í•„ìš”í•œ static íŒŒì¼ì˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.

  ![12.png](/images/front/post/2021-10-01-vue-ssr/12.png)


ì´ì œ `build:all` ëª…ë ¹ì„ ì‹¤í–‰í•´ë´…ì‹œë‹¤.

```bash
> yarn build:all
```

![13.png](/images/front/post/2021-10-01-vue-ssr/13.png)

ì´ë ‡ê²Œ `vue-ssr-client-manifest.json`ê³¼ `vue-ssr-server-bundle.json`ì´ ìˆì–´ì•¼ ì •ìƒì ìœ¼ë¡œ buildê°€ ëœ ê²ƒì…ë‹ˆë‹¤.

ì´ì œ Server Sideì—ì„œ **client manifestë¥¼ ì´ìš©í•˜ì—¬ static fileì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë„ë¡** ì‘ì—…í•´ì•¼ í•©ë‹ˆë‹¤.

```jsx
const express = require("express");
const { createBundleRenderer } = require("vue-server-renderer");

const app = express();

// `/server/public` í´ë”ì˜ íŒŒì¼ë“¤ì„ `static` íŒŒì¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.
app.use(express.static('./public'));

// SSRë¡œ ë§Œë“¤ì–´ì§„ htmlì´ <!--vue-ssr-outlet--> ìœ„ì¹˜ì— ì‚½ì…ë©ë‹ˆë‹¤.
const template = `
  <!DOCTYPE html>
  <html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Vue Simple SSR</title>
  </head>
  <body>
  <!--vue-ssr-outlet-->
  </body>
  </html>
`;

const ssrBundle = require('./public/vue-ssr-server-bundle.json');
const clientManifest = require('./public/vue-ssr-client-manifest.json');

// clientManifestë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì¤„ ê²½ìš°, style, script, state ë“±ì„ ìë™ìœ¼ë¡œ ì‚½ì…í•©ë‹ˆë‹¤.
const renderer = createBundleRenderer(ssrBundle, {
  template,
  clientManifest, 
});

// ëª¨ë“  í˜ì´ì§€ì— ëŒ€í•´ ë§¤ì¹­í•©ë‹ˆë‹¤.
app.get("/*", async ({ url }, res) => {
  // renderToStringì— ë„˜ê²¨ì§€ëŠ” íŒŒë¼ë¯¸í„°ê°€ contextì…ë‹ˆë‹¤.
  // ì¦‰, renderToStringì´ main-ssr.jsë¥¼ ì‹¤í–‰í•˜ë©° ë°˜í™˜í•˜ëŠ” ê²ƒì´ë¼ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  res.send(await renderer.renderToString({ url }));
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000')
});
```

ì´ë ‡ê²Œ ì‘ì„±í•œ í›„ì— ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ , ì†ŒìŠ¤ë³´ê¸°ë¥¼ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¬¼ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![14.png](/images/front/post/2021-10-01-vue-ssr/14.png)

ê²°ê³¼ë¬¼ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

![8.gif](/images/front/post/2021-10-01-vue-ssr/gif/8.gif)

- styleë„ ì •ìƒì ìœ¼ë¡œ ì ìš©ë˜ì—ˆê³ 
- scriptë„ ì‚½ì…ë˜ì–´ spa ë°©ì‹ìœ¼ë¡œ ì‘ë™í•˜ë©°
- í´ë¦­ ì´ë²¤íŠ¸ë„ ì •ìƒì‘ë™ í•˜ê³  ìˆìŠµë‹ˆë‹¤.

### (6) State ë™ê¸°í™”

ë§ˆì§€ë§‰ìœ¼ë¡œ, ê°„ë‹¨í•˜ê²Œ stateë¥¼ ë™ê¸°í™” í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤. ë”°ë¡œ DBë‚˜ APIë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ serverì—ì„œ ë¡œì»¬ì— ì„ ì–¸ëœ ë³€ìˆ˜ë¥¼ ì¡°ì‘í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì•Œì•„ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

1. /server/src/store.js

ë¨¼ì € ì„œë²„ì—ì„œ ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©í•  storeë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

```jsx
const store = {
  state: {
    todoItems: [
      { id: 1, content: 'CSRì„ ë§Œë“¤ì–´ë³´ì', activation: true },
      { id: 2, content: 'CSR ì½”ë“œ ë¶„í• ', activation: true },
      { id: 3, content: 'SSRì„ ë§Œë“¤ì–´ë³´ì', activation: false },
    ],
  },
  setState (newState) {
    this.state = { ...this.state, ...newState };
  }
}

module.exports = store;
```

1. /server/app.js

ê·¸ë¦¬ê³  stateë¥¼ ìˆ˜ì •í•˜ê³  ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” api endpointë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ë©°, ssrì„ í•˜ëŠ” ì‹œì ì— stateë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

```jsx
const express = require("express");
const { createBundleRenderer } = require("vue-server-renderer");

// storeë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
const store = require("./src/store");

const app = express();

app.use(express.static('./public'));

// SSR ê´€ë ¨ ì½”ë“œ
const template = /** í…œí”Œë¦¿ ì½”ë“œ ìƒëµ **/;
const ssrBundle = require('./public/vue-ssr-server-bundle.json');
const clientManifest = require('./public/vue-ssr-client-manifest.json');
const renderer = createBundleRenderer(ssrBundle, { template, clientManifest });

// request bodyë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë„ë¡ ë¯¸ë“¤ì›¨ì–´ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
app.use(express.json());

// storeì˜ stateë¥¼ ê°€ì ¸ì˜¤ëŠ” endpoint
app.get("/api/state", (req, res) => {
  res.json(store.state);
})

// storeì˜ stateë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” endpoint
app.put("/api/state", (req, res) => {
  store.setState(req.body);
  res.status(204).send();
})

app.get("/*", async ({ url }, res) => {
  // contextì— stateë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
  const { state } = store;
  res.send(await renderer.renderToString({ url, state }));
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000')
});
```

ì´ë ‡ê²Œ `context`ì— `state`ê°€ ìˆì„ ê²½ìš°, ë‹¤ìŒê³¼ ê°™ì´ `window.__INITIAL_STATE__` ë³€ìˆ˜ê°€ htmlì— ì‚½ì…ë©ë‹ˆë‹¤.

![15.png](/images/front/post/2021-10-01-vue-ssr/15.png)

ì´ì œ SSRì„ í•˜ëŠ” ì‹œì ê³¼, CSRì„ í•˜ëŠ” ì‹œì ì— í•´ë‹¹ stateë¥¼ ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…í•´ì•¼í•©ë‹ˆë‹¤.

1. /client/src/main-ssr.js

ë¨¼ì € ssrì„ í•˜ëŠ” ì‹œì ì— ì„œë²„ì—ì„œ ì œê³µí•˜ëŠ” stateë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë Œë”ë§í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import App from './App.vue';
import createRouter from './router';
import createStore from './store';

export default (context) => new Promise(async (resolve, reject) => {

  const router = createRouter();
  const store = createStore();

  // contextì—ì„œ stateë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
  const { url, state } = context;
  
  // storeì— ë°˜ì˜í•©ë‹ˆë‹¤.
  store.commit('SET_TODO_ITEMS', state.todoItems);

  await router.push(url);

  router.onReady(() => resolve(
    new Vue({
      router,
      store,
      render: h => h(App)
    }))
  );
})
```

1. /client/src/main.js

csrì„ í•˜ëŠ” ì‹œì ì— `window.__INITIAL_STATE__`ë¥¼ ì½ì–´ì™€ì„œ ë°˜ì˜í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

```jsx
import Vue from 'vue';
import App from './App.vue';
import createRouter from './router';
import createStore from './store';

Vue.config.productionTip = false

const router = createRouter();
const store = createStore();

if (window.__INITIAL_STATE__) {
  store.replaceState(window.__INITIAL_STATE__)
}

new Vue({
  router,
  store,
  render: h => h(App)
}).$mount('#app');
```

1. /client/vue.config.js

ê°œë°œì„œë²„ì—ì„œ api ìš”ì²­ì„ í•  ë• proxyë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
const VueSSRServerPlugin = require('vue-server-renderer/server-plugin');
const VueSSRClientPlugin = require('vue-server-renderer/client-plugin');
const nodeExternals = require('webpack-node-externals');
const isSSR = Boolean(process.env.SSR);
const isProduction = process.env.NODE_ENV === 'production';

module.exports = {
  outputDir: '../server/public',

  pages: { /** ìƒëµ **/ },

  devServer: {
    proxy: {
      // `/api/**` ì²˜ëŸ¼ ìš”ì²­í•  ë•Œ 3000 portì— ìˆëŠ” endpointë¥¼ proxyë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      "^/api": {
        target: "http://localhost:3000"
      }
    }
  },

  chainWebpack: config => { /** ìƒëµ **/ },
}
```

1. /client/src/views/TodoList.vue

ì´ì œ api ìš”ì²­ì„ ìœ„í•´ axiosë¥¼  ì„¤ì¹˜í•©ë‹ˆë‹¤. (ì‚¬ì‹¤ fetchë¥¼ ì‚¬ìš©í•´ë„ ìƒê´€ ì—†ìŠµë‹ˆë‹¤)

```bash
# í˜„ì¬ í´ë” ì¡°íšŒ í›„ client í´ë”ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.
> pwd
/f/projects/simple-vue-ssr/client

# client í”„ë¡œì íŠ¸ì— axiosë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
> yarn add axios
```

ì´ì œ TodoListì—ì„œ toggleì„ í•˜ë©´ serverì— ìˆëŠ” todoItemsì— ë°˜ì˜í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

```jsx
<template><!-- ìƒëµ --></template>

<script>
import { mapState, mapMutations } from "vuex";
// axiosë¥¼ importí•©ë‹ˆë‹¤.
import axios from "axios";

const pageTitle = "TodoList | Vue SSR";

export default {
  name: "TodoList",

  computed: {
    ...mapState(['todoItems']),
  },

  methods: {
    ...mapMutations(['SET_TODO_ITEMS']),

    toggle (id) {
      const todoItems = [ ...this.todoItems ];
      const selectedItem = todoItems.find(v => v.id === id);
      selectedItem.activation = !selectedItem.activation;
      this.SET_TODO_ITEMS(todoItems);

      // axiosë¡œ ì„œë²„ì— api ìš”ì²­ì„ í•˜ì—¬ serverìª½ stateë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
      axios.put("/api/state", { todoItems });
    }
  },
}
</script>

<style scoped></style>
```

ê²°ê³¼ë¬¼ì„ í™•ì¸í•˜ëŠ” ë°©ë²•ì€ ì¼ë‹¨ ê°œë°œì„œë²„ì—ì„œ í™•ì¸í•˜ëŠ” ë°©ë²•ì´ ìˆê³ , ë¹Œë“œ í›„ì— í™•ì¸í•˜ëŠ” ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

- ê°œë°œì„œë²„ë¥¼ ì´ìš©í•  ê²½ìš°
  - clientì™€ server ëª¨ë‘ ì„œë²„ë¥¼ ì‹¤í–‰í•´ì•¼í•©ë‹ˆë‹¤.

      ```bash
      # client í”„ë¡œì íŠ¸ì—ì„œ ê°œë°œ ì„œë²„ ì‹¤í–‰
      > yarn serve
      
      # server í”„ë¡œì íŠ¸ë¡œ ì´ë™ í›„ ì„œë²„ ì‹¤í–‰
      > cd ../server
      > yarn serve
      ```

  - ê·¸ë˜ì•¼ clientì—ì„œ proxyë¥¼ ì´ìš©í•˜ì—¬ api ìš”ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

    ![9.gif](/images/front/post/2021-10-01-vue-ssr/gif/9.gif)

  - ê°œë°œì„œë²„ì´ë¯€ë¡œ `8080` portë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - CSRë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì†ŒìŠ¤ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ `<div id="app"></div>` ìœ¼ë¡œ í‘œê¸°ë©ë‹ˆë‹¤.
- ì „ì²´ ë¹Œë“œ í›„ì— í™•ì¸í•  ê²½ìš°
  - clientë¥¼ build í›„ì— serverì—ì„œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.

      ```bash
      # client í”„ë¡œì íŠ¸ build
      > yarn build:all
      
      # server í”„ë¡œì íŠ¸ë¡œ ì´ë™ í›„ ì„œë²„ ì‹¤í–‰
      > cd ../server
      > yarn serve
      ```

  - express serverì´ê¸° ë•Œë¬¸ì— `3000` portë¥¼ ì‚¬ìš©í•˜ê³ , ì†ŒìŠ¤ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ SSRì´ ì ìš©ëœê±¸ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ![10.gif](/images/front/post/2021-10-01-vue-ssr/gif/10.gif)


### (7) SSR ì‹¤íŒ¨ì‹œ CSRì„ ì‹¤í–‰í•˜ë„ë¡ ì‘ì—…í•˜ê¸°

ë¨¼ì € ê¸°ì¡´ì— ë³€ìˆ˜ë¡œ ê´€ë¦¬ë˜ê³  ìˆë˜ `ssr template`ì„ íŒŒì¼ë¡œ ë¶„ë¦¬í•´ì•¼í•©ë‹ˆë‹¤.

1. /server/template/ssr_index.html

```jsx
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Vue Simple SSR</title>
</head>
<body>
<!--vue-ssr-outlet-->
</body>
</html>
```

1. /server/src/ssr.service.js

ssrì„ ìœ„í•œ service íŒŒì¼ì„ ë§Œë“¤ê³ , ê¸°ì¡´ì— app.jsì— ì¡´ì¬í•˜ë˜ ë¡œì§ì„ ìœ„ì„í•´ì•¼í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  buildë¥¼ í•  ë•Œ í¬í•¨ëœ `template/index.html`ì€ CSRì„ í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
const { createBundleRenderer } = require("vue-server-renderer");
const fs = require('fs');
const { join } = require('path');

// csrê³¼ ssrì— ì‚¬ìš©ë˜ëŠ” templateì˜ ê²½ë¡œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
const ssrTemplatePath = join(process.cwd(), 'template/ssr_index.html');
const csrTemplatePath = join(process.cwd(), 'template/index.html');

// ssr templateì„ ì½ì–´ì˜µë‹ˆë‹¤.
const template = fs.readFileSync(ssrTemplatePath, 'utf-8');

// csr templateì„ ì½ì–´ì˜µë‹ˆë‹¤.
const csrTemplate = fs.readFileSync(csrTemplatePath, 'utf-8');

// rendererë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
const bundle = require("../public/vue-ssr-server-bundle.json");
const clientManifest = require("../public/vue-ssr-client-manifest.json");
const renderer = createBundleRenderer(bundle, { clientManifest, template });

module.exports = {
  async getHtml (context) {
    try {
      return await renderer.renderToString(context);
    } catch (e) {
      // ssrì´ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ì„ë•Œ, ì¦‰ ì˜¤ë¥˜ê°€ ìˆì„ ë• csrì„ í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.
      return csrTemplate;
    }
  }
}
```

1. /server/app.js

ssr ê´€ë ¨ ë¡œì§ì„ ë¶„ë¦¬í–ˆê¸° ë•Œë¬¸ì— app.jsì— ìˆëŠ” ì½”ë“œë„ ì •ë¦¬í•´ì•¼í•©ë‹ˆë‹¤.

```jsx
const express = require("express");
const ssrService = require("./src/ssr.service");
const store = require("./src/store");

const app = express();

app.use(express.json());
app.use(express.static('./public'));

app.get("/api/state", (req, res) => {
  res.json(store.state);
})

app.put("/api/state", (req, res) => {
  store.setState(req.body);
  res.status(204).send();
})

app.get("/*", async ({ url }, res) => {
  const { state } = store;
  res.send(await ssrService.getHtml({ url, state }));
});

app.listen(3000, () => {
  console.log('listen to http://localhost:3000')
})
```

ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ SSR ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë”ë¼ë„ UIëŠ” ì‚¬ìš©ìë“¤ì—ê²Œ ì •ìƒì ìœ¼ë¡œ ë³´ì—¬ì§€ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

## 4. SSRì„ ì‘ì—…í•  ë•Œ ìœ ì˜í•  ì 

ì•ì„  ê³¼ì •ì„ í†µí•´ì„œ SSRì„ ì ìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ìƒì„¸íˆ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤. ì•„ë§ˆ ë‚´ìš©ì´ ë§ê¸° ë•Œë¬¸ì— ì „ì²´ì ì¸ ë‚´ìš©ì„ ì „ë¶€ ì´í•´í•˜ê¸°ëŠ” ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë˜ë„ ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì€ SSRì„ í•  ë•Œ ë°˜ë“œì‹œ ì•Œì•„ì•¼í•©ë‹ˆë‹¤.

### (1) ë¸Œë¼ìš°ì € í™˜ê²½ê³¼ Node.js í™˜ê²½ì„ êµ¬ë¶„í•˜ê¸°

- ê¸°ë³¸ì ìœ¼ë¡œ SSRì„ í•  ë• window, document ê°™ì€ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‚¬ìš©ë˜ëŠ” ê°ì²´ë¥¼ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ë”°ë¼ì„œ ì´ë²¤íŠ¸ ë“±ë¡ì´ë‚˜ DOM ì ‘ê·¼ì´ í•„ìš”í•œ ê²½ìš°ëŠ” ì „ë¶€ CSR ì‹œì  (mounted)ì— ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

ê·¸ëŸ°ë° ì–´ì©” ìˆ˜ ì—†ì´ windowë‚˜ documentê°€ ssr ë¹Œë“œ ì‹œì ì— ë§ë ¤ë“¤ì–´ê°€ëŠ” ê²½ìš°ê°€ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ íŒ¨í‚¤ì§€ê°€ ssrì„ ê³ ë ¤í•˜ê³  ë§Œë“¤ì§„ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì´ëŸ´ ë• [jsdom](https://www.google.com/search?q=jsdom&oq=jsdom&aqs=chrome..69i57j69i60l3j69i65j69i60l3.439j0j1&sourceid=chrome&ie=UTF-8) ê°™ì€ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ìƒì˜ window, document ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹µë‹ˆë‹¤.

### (2) api ìš”ì²­ì´ í•„ìš”í•  ë• axiosë¥¼ ì‚¬ìš©í•˜ê¸°

ë³¸ë¬¸ì—ì„œëŠ” íŠ¹ë³„í•œ ì´ìœ  ì—†ì´ axiosë¥¼ ì‚¬ìš©í•œ ê²ƒ ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ, axiosì˜ ê²½ìš° node.js í™˜ê²½ì—ì„œë„ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ssr ì‹œì ì— api ìš”ì²­ì´ í•„ìš”í•˜ë‹¤ë©´ ê°€ê¸‰ì  axiosë¥¼ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. í˜¹ì€ ì•„ì˜ˆ csr ì‹œì ì— apië¥¼ ìš”ì²­í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

### (3) CSRì€ One Client, SSRì€ Multi Client

CSRì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¸Œë¼ìš°ì € í™˜ê²½ì—ì„œ ë Œë”ë§ì„ í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìˆ˜ì˜ ì‚¬ìš©ìë¥¼ ê³ ë ¤í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ SSRì˜ ê²½ìš° íŠ¹ì • Requestì— ëŒ€í•œ Responseë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ìë§ˆë‹¤ Storeë„ ë‹¤ë¥´ê³  Routerë„ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ìŠµí•œ ì½”ë“œë¥¼ ì˜ˆë¡œë“¤ìë©´ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- A ì‚¬ìš©ìëŠ” ë©”ì¸í˜ì´ì§€ (`GET /`)ë¡œ ì ‘ê·¼
  - ë©”ì¸í˜ì´ì§€ì— ëŒ€í•œ HTMLì„ ë Œë”ë§í•´ì„œ ë³´ì—¬ì¤˜ì•¼í•¨
- B ì‚¬ìš©ìëŠ” TodoList í˜ì´ì§€(`GET /todo-list`)ë¡œ ì ‘ê·¼
  - ì„œë¸Œí˜ì´ì§€ì— ëŒ€í•œ HTMLì„ ë Œë”ë§í•´ì„œ ë³´ì—¬ì¤˜ì•¼í•¨
- ë”°ë¼ì„œ  Routerê°€ ì‚¬ìš©ìì˜ Request ë§ˆë‹¤ ìƒì„±ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì ì„ ì´í•´í•´ì•¼í•©ë‹ˆë‹¤.

ë§Œì•½ì— storeì™€ routerë¥¼ requestë§ˆë‹¤ ìƒì„±í•˜ì§€ ì•Šì„ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì´ ë²Œì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ì‚¬ìš©ìê°€ ì´ 10ëª…ì„
- A ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í–ˆìŒ
- í•œ ê°œì˜ Storeë¥¼ ì‚¬ìš©í•  ê²½ìš°, Aì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ì •ë³´ê°€ storeì— ë°˜ì˜ëœë‹¤ë©´ ëª¨ë“  ì‚¬ìš©ìê°€ A ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ í™”ë©´ìœ¼ë¡œ ë Œë”ë§ëœ ì‘ë‹µê°’ì„ ë°›ì„ ìˆ˜ ìˆìŒ

ì‰½ê²Œ ë§í•´ì„œ Aê°€ ë¡œê·¸ì¸í•˜ë©´, ëª¨ë“  ì‚¬ìš©ìê°€ Aê°€ ë¡œê·¸ì¸í•œ ë‚´ìš©ì´ ë°˜ì˜ëœ storeë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë Œë”ë§ëœ ì‘ë‹µê°’ì„ ë°›ê²Œ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ìƒê°ë§Œí•´ë„ ë”ì°í•œ ì¥ì• ê°€ ì•„ë‹Œê°€ìš”?

### (4) Serverê°€ ê¼­ í•„ìš”í•¨

ë‹¹ì—°í•˜ì§€ë§Œ Server Side Rendering ì´ê¸° ë•Œë¬¸ì— ë Œë”ë§ì„ í•´ì£¼ëŠ” Serverê°€ ê¼­ í•„ìš”í•©ë‹ˆë‹¤.

ì¤Œì¸í„°ë„·ì€ front serverì™€ api serverë¥¼ êµ¬ë¶„í•˜ì—¬ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

front serverê¹Œì§€ ê´€ë¦¬í•˜ëŠ”ê²Œ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìì˜ ì˜ì—­ì´ê³ , api serverì˜ ê²½ìš° ë°±ì—”ë“œ ê°œë°œìë“¤ì´ ê´€ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.

### (5) SSRì€ ë¬´ì¡°ê±´ buildë¥¼ í•´ì„œ í™•ì¸í•´ì•¼í•¨

ì•ì„  ê³¼ì •ì—ì„œ ì‚´í´ë³¸ ê²ƒ ì²˜ëŸ¼ vue í”„ë¡œì íŠ¸ë¥¼ buildí•˜ë©´ bundle íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤. í•´ë‹¹ íŒŒì¼ì´ ìˆì–´ì•¼ SSRì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

í•˜ì§€ë§Œ serverì—ì„œë„ webpackì„ ì‚¬ìš©í•˜ê³ , vue-loaderë¥¼ ë¶™ì¸ë‹¤ë©´ ê¼­ ë¹Œë“œí•˜ì§€ ì•Šì•„ë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì¶”ì²œí•˜ëŠ” ë°©ë²•ì€ ì•„ë‹™ë‹ˆë‹¤.

ì–´ì¨Œë“  ì´ëŸ¬í•œ ì´ìœ  ë•Œë¬¸ì— SSR ì´ ì˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  ë””ë²„ê·¸ í•˜ëŠ” ê³¼ì •ì€ ë¬´ì²™ ê³ í†µìŠ¤ëŸ½ìŠµë‹ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ í´ ìˆ˜ë¡ ë¹Œë“œ ì‹œê°„ì´ ê¸¸ì–´ì§€ê¸° ë•Œë¬¸ì´ì£ !

ê·¸ë¦¬ê³  SSR ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” íŠ¹íˆ ë””ë²„ê·¸í•˜ê¸°ê°€ í˜ë“¤ë‹µë‹ˆë‹¤.

### (6) ì„ íƒì  SSR

ëª¨ë“  í˜ì´ì§€ì— ëŒ€í•´ì„œ SSRì„ ì ìš©í•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤.

ì´ê±´ ìµœê·¼ì— ì˜¤í”ˆí•œ [ZUM ê¸ˆìœµ](https://finance.zum.com/)ì˜ ì¼ë¶€ ì½”ë“œì¸ë°ìš”

```tsx
import { Controller, Get, Post, Req, Res } from "@zum-portal-core/backend";
import {Request, Response} from "express";

import {BaseDataFacade} from "@/modules/base-data/base.data.facade";
import { SsrService, CsrService } from "@/modules/renderer/services";

@Controller()
export class HomeController {
  constructor(
    private readonly baseDataFacade: BaseDataFacade,
    private readonly ssrService: SsrService,
    private readonly csrService: CsrService,
  ) {}

  @Get([
    "/news/article/*", // ë‰´ìŠ¤ìƒì„¸í˜ì´ì§€
    "/internal/item/*", // ì¢…ëª©ìƒì„¸í˜ì´ì§€
    "/internal/etf-detail/*", // etf ì¢…ëª©ìƒì„¸í˜ì´ì§€
    "/internal/index/*", // ì§€ìˆ˜ìƒì„¸í˜ì´ì§€
    "/investment/view/*", // íˆ¬ìë…¸íŠ¸
  ])
  public async getSSRPage (
    @Req() req: Request,
    @Res() res: Response
  ): Promise<void> {
    const renderedHtml = process.env.NODE_ENV.startsWith('production')
                          ? await this.renderByServer(req)
                          : await this.renderByClient(req)

    res.send(renderedHtml);
  }

  @Post("/investment/view-preview")
  public getInvestmentPreview (@Req() req: Request) {
    return this.renderByClient(req);
  }

  @Get(["/*"])
  public async getCSRPage(@Req() req: Request) {
    return this.renderByClient(req);
  }

  /** Client Side ë Œë”ë§ ì‘ì—… **/
  private async renderByClient (req: Request) {
    const pageData = await this.baseDataFacade.fetchDataByPath(req);
    return this.csrService.getRenderedHtml(pageData);
  }

  /** Server Side ë Œë”ë§ ì‘ì—… **/
  private async renderByServer (req: Request) {
    const pageData = await this.baseDataFacade.fetchDataByPath(req);
    return this.ssrService.getRenderedHtml(req.path, pageData);
  }

}
```

ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒ ì²˜ëŸ¼, íŠ¹ì • í˜ì´ì§€ë¥¼ ì œì™¸í•˜ê³¤ ì „ë¶€ CSRì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  SSR ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì—, ì´ëŸ´ ê²½ìš° CSRì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…í•´ì£¼ë©´ ë”ìš± ì¢‹ìŠµë‹ˆë‹¤.

## ê¸€ì„ ë§ˆì¹˜ë©°

ìƒê°í–ˆë˜ ê²ƒ ë³´ë‹¤ ê¸€ì´ ë¬´ì²™ ê¸¸ì–´ì¡ŒìŠµë‹ˆë‹¤. ê·¸ë˜ë„ í•˜ê³  ì‹¶ì€ ì´ì•¼ê¸°ë¥¼ ë§ì´ ë‹´ì§€ ëª»í•œ ê²ƒ ê°™ì•„ì„œ ì•„ì‰½ë„¤ìš”. SSR ë•Œë¬¸ì— ê³ ìƒí•˜ëŠ” ëª¨ë“  ì´ë“¤ì„ ìœ„í•´ ì´ ê¸€ì„ ë°”ì¹©ë‹ˆë‹¤ ğŸ™‡â€â™‚ï¸

## ì „ì²´ ì½”ë“œ í™•ì¸í•´ë³´ê¸°

- [Vanilla Javascript SSR](https://github.com/JunilHwang/simple-ssr)
- [Vue Simple SSR](https://github.com/JunilHwang/simple-vue-ssr)
