I"Ÿé<p>ì§€ë‚œ ë²ˆ ê¸€ì— ì´ì–´ì„œ ì‹¤ì œ ì—°ë™ ê³¼ì • ì…ë‹ˆë‹¤.</p>

<p>ì „ì²´ ê¸€ì˜ ëª©ì°¨ì…ë‹ˆë‹¤.</p>

<ol>
  <li>ë„ì… ë°°ê²½</li>
  <li>ê´€ë ¨ ì—°êµ¬</li>
  <li>RabbitMQ ë”°ë¼ì¡ê¸°</li>
  <li>Spring Cloud Stream , RabbitMQ ì—°ë™í•˜ê¸°</li>
  <li>ì¶”ê°€ ì‘ì—…</li>
  <li>ì •ë¦¬</li>
</ol>

<p>ì§€ë‚œ ê¸€ì—ëŠ” ë„ì…ë°°ê²½, ê´€ë ¨ì—°êµ¬, RabbitMQì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ì˜€ìŠµë‹ˆë‹¤.<br />
<a href="https://zumdev.github.io/spring_cloud_stream_rabbitmq_01/">SPRING CLOUD STREAM, MQ ë„ì… ì‚¬ë¡€ - 1.ê¸°ë³¸ê°œë…</a></p>

<p>ì´ë²ˆ ê¸€ì—ì„œëŠ” Spring Cloud Stream, Rabbit ì—°ë™í•˜ê¸° ë° ì¶”ê°€ ì‘ì—…ì— ëŒ€í•´ì„œ ê³µìœ í•©ë‹ˆë‹¤.</p>

<h1 id="4-rabbitmq-ì—°ë™í•˜ê¸°">4. RabbitMQ ì—°ë™í•˜ê¸°</h1>

<p>ìë°”+ìŠ¤í”„ë§ ì›¹ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œ RabbitMQ ì—°ë™ì„ í• ìˆ˜ ìˆëŠ” ë°©ë²•ì— ëŒ€í•´ì„œ ì†Œê°œí•©ë‹ˆë‹¤.
ì°¸ê³ ë¡œ Consumer(=Subcribe) ì…ì¥ì—ì„œë§Œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>RabbitMQ Java client library(com.rabbitmq.client)</li>
  <li>Spring Framework RabbitMQ</li>
  <li>Spring Cloud Stream RabbitMQ binder 1.0.3</li>
  <li>Spring Cloud Stream RabbitMQ binder 1.2.0</li>
</ul>

<h4 id="41-rabbitmq-java-client-library">4.1 RabbitMQ Java client library</h4>

<p>com.rabbitmq.client ì…ë‹ˆë‹¤.
ê¸°ë³¸ì ì¸ ì—°ë™ í”„ë¡œì„¸ìŠ¤ëŠ” ConnectionFactory â€“&gt; Connection â€“&gt; Channel ìƒì„±ì˜ ìˆœì„œì…ë‹ˆë‹¤.</p>

<ul>
  <li>ConnectionFactory :</li>
  <li>Connection :</li>
  <li>Channel :</li>
</ul>

<p><img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_scs_rabbit01.png" alt="rabbitmq ê¸°ë³¸ ì—°ë™" /></p>

<p>ê¸‰í•˜ê²Œ(?) ê·¸ë ¤ë³¸ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì„ ë³´ë©´ ConnectionFactory íŒ©í† ë¦¬ë¥¼ ìƒì„±í•˜ê³ , íŒ©í† ë¦¬ì—ì„œ newConnection() ìœ¼ë¡œ ì»¤ë„¥ì…˜ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œëŠ” createChannel() ë¥¼ ì‹¤í–‰í•˜ì—¬ ì±„ë„ì„ ìƒì„±í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.
ì†ŒìŠ¤ ì˜ˆì œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">com.rabbitmq.client.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.Channel</span><span class="o">;</span>

<span class="nc">ConnectionFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ConnectionFactory</span><span class="o">();</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="n">userName</span><span class="o">);</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setVirtualHost</span><span class="o">(</span><span class="n">virtualHost</span><span class="o">);</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setHost</span><span class="o">(</span><span class="n">hostName</span><span class="o">);</span>
<span class="n">factory</span><span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="n">portNumber</span><span class="o">);</span>
<span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">newConnection</span><span class="o">();</span> <span class="c1">// ì»¤ë„¥ì…˜ ìƒì„±</span>

<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

<span class="nc">Channel</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createChannel</span><span class="o">();</span> <span class="c1">// ì±„ë„ ìƒì„±</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">Channel</code> ê°ì²´ì—ì„œëŠ” ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸, í ì„ ì–¸, ìµìŠ¤ì²´ì¸ì§€-í ë°”ì¸ë”© ë“± í•µì‹¬ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
ê° ì—­í• ì— ë”°ë¼ì„œ exchangeDeclare(), queueDeclare(), queueBind() ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì •ë¦¬í•˜ë©´</p>

<p>íŒ©í† ë¦¬â€“&gt;ì»¤ë„¥ì…˜â€“&gt;ì±„ë„â€“&gt;ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸â€“&gt;í ì„ ì–¸ â€“&gt; í ë°”ì¸ë”©</p>

<p>ìˆœì„œë¡œ RabbitMQ ì—°ë™ì„ í•©ë‹ˆë‹¤.</p>

<p>ìâ€¦ êµ³ì´ ì´ë¶€ë¶„ì„ ì™œ ì„¤ëª…ì„ í•˜ëƒë©´ìš”, ìŠ¤í”„ë§ì—ì„œ ì œê³µí•´ì£¼ëŠ” ê¸°ìˆ ë„ ë§ˆì°¬ê°€ì§€ë¡œ ë˜‘ê°™ì€ í”„ë¡œì„¸ìŠ¤ë¡œ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ê¸°ë³¸ íë¦„ì€ ì´í•´ í•  í•„ìš”ëŠ” ìˆìŠµë‹ˆë‹¤.</p>

<p>ì°¸ê³ ë¡œ ì—°ê²°ì„ ì‹¤íŒ¨í–ˆê±°ë‚˜ ê°•ì œë¡œ ì±„ë„ ë˜ëŠ” ì»¤ë„¥ì…˜ì´ ì¢…ë£Œê°€ ëœ ê²½ìš°ë¥¼ ëŒ€ë¹„í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ì…§ë‹¤ìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">com.rabbitmq.client.ShutdownSignalException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.rabbitmq.client.ShutdownListener</span><span class="o">;</span>

<span class="n">connection</span><span class="o">.</span><span class="na">addShutdownListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">ShutdownListener</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdownCompleted</span><span class="o">(</span><span class="nc">ShutdownSignalException</span> <span class="n">cause</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre></figure>

<p>ìì„¸í•œ ë‚´ìš©ì€ RabbitMQ ê³µì‹ ê°€ì´ë“œì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br />
<a href="https://www.rabbitmq.com/api-guide.html" target="_blank">https://www.rabbitmq.com/api-guide.html</a></p>

<h4 id="42-spring-framework-rabbitmq">4.2 Spring Framework RabbitMQ</h4>

<p>Spring Cloud Stream ì´ ë‚˜ì˜¤ê¸° ì „ì—, ëŒ€ë¶€ë¶„ì€ ìŠ¤í”„ë§ í™˜ê²½ì˜ í”Œë«í¼ì—ì„œëŠ” í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬(org.springframework.amqp)ë¡œ RabbitMQ ì—°ë™ì„ êµ¬ì¶•í•˜ì˜€ì„ ê²ƒì…ë‹ˆë‹¤. 
ì‹¤ì œë¡œ ì‚¬ë‚´ ì„œë¹„ìŠ¤ì—ì„œë„ í•´ë‹¹ ë°©ë²•ìœ¼ë¡œ ì—°ë™í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<p>ì¼ë‹¨ <code class="language-plaintext highlighter-rouge">ORG.SPRINGFRAMEWORK.AMQP</code> ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 4.1ì—ì„œ ì†Œê°œí•œ RabbitMQ Java client library(com.rabbitmq.client)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p><img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_spring_mq_useview.png" alt="Spring MQ - ì‚¬ìš©ë·°" /></p>

<p>ìŠ¤í”„ë§ ë ˆí¼ëŸ°ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ìƒ˜í”Œ ì†ŒìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
íŒ©í† ë¦¬â€“&gt;ì»¤ë„¥ì…˜â€“&gt;ì±„ë„â€“&gt;ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸â€“&gt;í ì„ ì–¸ â€“&gt; í ë°”ì¸ë”© ì˜ ì—°ë™ í”„ë¡œì„¸ìŠ¤ëŠ” ê°™ìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">hello</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Binding</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.BindingBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.Queue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.core.TopicExchange</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.connection.ConnectionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.amqp.rabbit.listener.adapter.MessageListenerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="o">{</span>

    <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="s">"spring-boot"</span><span class="o">;</span>

    <span class="nd">@Bean</span>
    <span class="nc">Queue</span> <span class="nf">queue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Queue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">TopicExchange</span> <span class="nf">exchange</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TopicExchange</span><span class="o">(</span><span class="s">"spring-boot-exchange"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">Binding</span> <span class="nf">binding</span><span class="o">(</span><span class="nc">Queue</span> <span class="n">queue</span><span class="o">,</span> <span class="nc">TopicExchange</span> <span class="n">exchange</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="n">queueName</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">SimpleMessageListenerContainer</span> <span class="nf">container</span><span class="o">(</span><span class="nc">ConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">,</span>
            <span class="nc">MessageListenerAdapter</span> <span class="n">listenerAdapter</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SimpleMessageListenerContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleMessageListenerContainer</span><span class="o">();</span>
        <span class="n">container</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">);</span>
        <span class="n">container</span><span class="o">.</span><span class="na">setQueueNames</span><span class="o">(</span><span class="n">queueName</span><span class="o">);</span>
        <span class="n">container</span><span class="o">.</span><span class="na">setMessageListener</span><span class="o">(</span><span class="n">listenerAdapter</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">MessageListenerAdapter</span> <span class="nf">listenerAdapter</span><span class="o">(</span><span class="nc">Receiver</span> <span class="n">receiver</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MessageListenerAdapter</span><span class="o">(</span><span class="n">receiver</span><span class="o">,</span> <span class="s">"receiveMessage"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">Application</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ìƒì„¸í•œ ê°€ì´ë“œëŠ” https://spring.io/guides/gs/messaging-rabbitmq/ ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<h4 id="43-spring-cloud-stream-binder-rabbit-103-release">4.3 Spring Cloud Stream Binder Rabbit 1.0.3 RELEASE</h4>

<p>ì´ì œ ë“œë””ì–´!! <code class="language-plaintext highlighter-rouge">Spring Cloud Stream</code> ë¥¼ ê²€í† í•´ë³´ëŠ” ì‹œê°„ì…ë‹ˆë‹¤. 
ì°¸ê³ ë¡œ Spring Cloud Stream Binder Rabbit 1.0.3 RELEASE ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì´ ìµœì†Œ 1.3.7 (ë””íœë˜ì‹œ)ì ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

<p>ì¼ë‹¨ ëª¨ë“ˆë·°-ì‚¬ìš©ë·° ëŠ” ì´ë ‡ìŠµë‹ˆë‹¤.
<img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_spring_cloud_stream_rabbitmq_useview.png" alt="Spring Cloud Stream RabbitMQ - ì‚¬ìš©ë·°" /></p>

<p>ëŒ€ëµì ì¸ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
<img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_scs_release_103_01.png" alt="Spring Cloud Stream 1.0.3 RELEASE" /></p>

<p><img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_scs_release_103_02.png" alt="Spring Cloud Stream 1.0.3 RELEASE" /></p>

<p>ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸, í ì„ ì–¸, ìµìŠ¤ì²´ì¸ì§€-í ë°”ì¸ë”© í•˜ëŠ” ë¶€ë¶„ì€ ì´ë ‡ê²Œ êµ¬í˜„ì´ ë˜ì–´ìˆë„¤ìš”.
í•µì‹¬ ë¡œì§ì€ doBindConsumer() ì—ì„œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binder</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">RabbitMessageChannelBinder</span>


<span class="kd">public</span> <span class="nc">Binding</span><span class="o">&lt;</span><span class="nc">MessageChannel</span><span class="o">&gt;</span> <span class="nf">doBindConsumer</span><span class="o">(</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="c1">//ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸</span>
<span class="nc">TopicExchange</span> <span class="n">exchange</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TopicExchange</span><span class="o">(</span><span class="n">exchangeName</span><span class="o">);</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span></code></pre></figure>

<p>ì­??? ìµìŠ¤ì²´ì¸ì§€ ì„ ì–¸ì„ TopicExchange ìœ¼ë¡œ í•©ë‹ˆë‹¤. ë¬´ì¡°ê±´ ìµìŠ¤ì²´ì¸ì§€ íƒ€ì…ì„ Topic ìœ¼ë¡œë§Œ ë§Œë“¤ê² ë‹¤ëŠ” ê·¸ëŸ° ì†ŒìŠ¤ì…ë‹ˆë‹¤ë§Œ?? ë­ì§€?</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binder</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">RabbitMessageChannelBinder</span>


<span class="kd">public</span> <span class="nc">Binding</span><span class="o">&lt;</span><span class="nc">MessageChannel</span><span class="o">&gt;</span> <span class="nf">doBindConsumer</span><span class="o">(</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="c1">//í ì„ ì–¸</span>
<span class="n">declareQueue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>

<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

<span class="c1">//ì‹¤ì œ íë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">declareQueue</span><span class="o">(</span><span class="nc">String</span> <span class="n">beanName</span><span class="o">,</span> <span class="nc">Queue</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">try</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">rabbitAdmin</span><span class="o">.</span><span class="na">declareQueue</span><span class="o">(</span><span class="n">queue</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">AmqpConnectException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Declaration of queue: "</span> <span class="o">+</span> <span class="n">queue</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">" deferred - connection not available"</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">addToAutoDeclareContext</span><span class="o">(</span><span class="n">beanName</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binder</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">RabbitMessageChannelBinder</span>

<span class="kd">public</span> <span class="nc">Binding</span><span class="o">&lt;</span><span class="nc">MessageChannel</span><span class="o">&gt;</span> <span class="nf">doBindConsumer</span><span class="o">(</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="c1">//ìµìŠ¤ì²´ì¸ì§€-í ë°”ì¸ë”© í˜¸ì¶œ</span>
<span class="k">if</span> <span class="o">(</span><span class="n">partitioned</span><span class="o">)</span> <span class="o">{</span>
	<span class="nc">String</span> <span class="n">bindingKey</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%s-%d"</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">properties</span><span class="o">.</span><span class="na">getInstanceIndex</span><span class="o">());</span>
	<span class="n">declareBinding</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="nc">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="n">bindingKey</span><span class="o">));</span>
<span class="o">}</span>
<span class="k">else</span> <span class="o">{</span>
	<span class="n">declareBinding</span><span class="o">(</span><span class="n">queue</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="nc">BindingBuilder</span><span class="o">.</span><span class="na">bind</span><span class="o">(</span><span class="n">queue</span><span class="o">).</span><span class="na">to</span><span class="o">(</span><span class="n">exchange</span><span class="o">).</span><span class="na">with</span><span class="o">(</span><span class="s">"#"</span><span class="o">));</span>
<span class="o">}</span>

<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>

<span class="c1">//ì‹¤ì œë¡œ ìµìŠ¤ì²´ì¸ì§€-í ë°”ì¸ë”©í•˜ëŠ” ë¶€ë¶„</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">declareBinding</span><span class="o">(</span><span class="nc">String</span> <span class="n">rootName</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">amqp</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">Binding</span> <span class="n">binding</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">try</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">rabbitAdmin</span><span class="o">.</span><span class="na">declareBinding</span><span class="o">(</span><span class="n">binding</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">catch</span> <span class="o">(</span><span class="nc">AmqpConnectException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">logger</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
			<span class="n">logger</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Declaration of binding: "</span> <span class="o">+</span> <span class="n">rootName</span> <span class="o">+</span> <span class="s">".binding deferred - connection not available"</span><span class="o">);</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">addToAutoDeclareContext</span><span class="o">(</span><span class="n">rootName</span> <span class="o">+</span> <span class="s">".binding"</span><span class="o">,</span> <span class="n">binding</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ë˜í•œ ì†ŒìŠ¤ë¥¼ ìì„¸íˆ ë³´ë©´ ë°”ì¸ë”©í‚¤ëŠ” ì˜¤ì§ name-instanceIndex ì˜ í˜•íƒœë¡œ êµ¬í˜„ë˜ì–´ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ nameì€ ìµìŠ¤ì²´ì¸ì§€ name ì…ë‹ˆë‹¤. 
ë­ì§€?? Topic íƒ€ì…ì¸ë° ë°”ì¸ë”©í‚¤ê°€ exchange-index ì˜ í˜•íƒœì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ìµìŠ¤ì²´ì¸ì§€ ì´ë¦„ì´ news ì´ê³  index ê°€ 1 ì´ë©´ news-1 ì´ëŸ° í˜•íƒœì…ë‹ˆë‹¤.
ì œê°€ ìœ„ì— ì„¤ëª…í–ˆë˜ *.news.# ì´ëŸ° í˜•íƒœë¡œ *, # ì´ ì ìš©ëœ í˜•íƒœë¡œ ë°”ì¸ë”©í‚¤ë¥¼ ì„¤ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
ì•„ë¬´íŠ¼ Topic íƒ€ì…ì¸ë° *,# ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì´ê±´ Topic íƒ€ì…ì„ Direct íƒ€ì… ì²˜ëŸ¼ ì“°ê³  ì‹¶ì„ë•Œ í•˜ëŠ” ê·¸ ë°©ë²•ì…ë‹ˆë‹¤.
ë˜í•œ partitioned ê°€ false ì¼ ê²½ìš°ì—ëŠ” bindingKey ëŠ” # ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. 
Topic íƒ€ì…ì—ì„œ ë°”ì¸ë”©í‚¤ë¥¼ #ìœ¼ë¡œ ì„¤ì • ëœ ê²½ìš°ì—ëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ë“¯ì´ Fanout íƒ€ì… ì²˜ëŸ¼ ë™ì‘í•©ë‹ˆë‹¤.</p>

<p>ë‹¤ì‹œ ì •ë¦¬í•˜ë©´ Spring Cloud Stream <code class="language-plaintext highlighter-rouge">1.0.3</code> RELEASE ë²„ì „ì€ ì˜¤ì§ Topic íƒ€ì…ë§Œ ì œê³µí•©ë‹ˆë‹¤!
í”„ë¡œí¼í‹° ì„¤ì •ì¸ partitioned ì˜ true/false ì— ë”°ë¼ì„œ Fanout ì²˜ëŸ¼ ë˜ëŠ” Direct ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ë§Œ ìˆê³  Topic íƒ€ì…ìœ¼ë¡œëŠ” ì“¸ìˆ˜ ì—†ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 
ë°”ì¸ë”©í‚¤ ì„¤ì • ë˜í•œ ë§¤ìš° ì œí•œì ì…ë‹ˆë‹¤.</p>

<p>ì—¬ê¸°ê¹Œì§€ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°±ë‹¨ ì†ŒìŠ¤ë¥¼ ë¶„ì„í•œ ê²ƒì´ê³ , ì‹¤ì œë¡œ MQ ì—°ë™ ì ìš©ì€ ì•„ì£¼ ê°„ë‹¨í•©ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">//ìŠ¤íŠ¸ë¦¼ ì—°ë™í•˜ê¸°</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">listener</span> <span class="o">{</span>

  <span class="o">...</span>

  <span class="nd">@StreamListener</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processVote</span><span class="o">(</span><span class="nc">Vote</span> <span class="n">vote</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">//service </span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>1.0.3 ë²„ì „ì— ëŒ€í•œ ìƒì„¸í•œ ë ˆí¼ëŸ°ìŠ¤ëŠ” ì•„ë˜ ë§í¬ì—ì„œ ì°¸ê³  ê°€ëŠ¥í•©ë‹ˆë‹¤.<br />
<a href="http://docs.spring.io/spring-cloud-stream/docs/1.0.3.RELEASE/reference/htmlsingle/index.html" target="_blank">ë ˆí¼ëŸ°ìŠ¤ë§í¬</a></p>

<p>í˜¹ì‹œë¼ë„ ì œê°€ ì†ŒìŠ¤ë¥¼ ì˜ëª» ë´¤ê±°ë‚˜ í–ˆë‹¤ë©´ ê¼­ ë§ì”€ë¶€íƒë“œë¦¬ê² ìŠµë‹ˆë‹¤ã… ã…  ì œê°€ ì˜ ëª°ë¼ì„œ ë©ì²­í•˜ê²Œ í—¤ë§¤ê³  ìˆì„ ê°€ëŠ¥ì„±ë„ ìˆìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>1.0.3.RELEASE ë²„ì „ì€ ë¼ìš°íŒ… ê·œì¹™ì„ ì ìš©í•˜ê¸°ì—ëŠ” ë„ˆë¬´ë‚˜ë„ ì œí•œì ì¸ ë¼ìš°íŒ…í‚¤,ìµìŠ¤ì²´ì¸ì§€íƒ€ì… ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
</blockquote>

<p>ì ê·¸ë˜ì„œ ì €ëŠ” 1.0.3 ë²„ì „ì€ ì‹¤ì„œë¹„ìŠ¤ì— ì ìš©í•˜ê¸°ì—ëŠ” ì• ë§¤í•˜ë‹¤ ë¼ëŠ” ê²°ë¡ ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤.
ìµìŠ¤ì²´ì¸ì§€ íƒ€ì…ë„ ì§€ì •ëª»í•˜ê³ , ë¼ìš°íŒ…í‚¤ë„ ì„¤ì •ë„ ì œí•œì ì´ë¼ë©´ ì°¨ë¼ë¦¬ Spring Cloud Stream ì•ˆì“°ê³  
4.2 Spring Framework RabbitMQ(org.springframework.amqp)ë¡œ êµ¬í˜„í•˜ëŠ”ê²Œ ë‚«ê² ë‹¤ëŠ” ìƒê°ë„ í–ˆì§€ë§Œ ì¼ë‹¨ ìƒìœ„ ë²„ì „ì„ ê²€í† í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>

<p>ì°¸ê³ ë¡œ ë°‘ì— ì‘ì„±í•˜ê² ì§€ë§Œ <code class="language-plaintext highlighter-rouge">1.2.0.RELEASE</code> ë²„ì „ì€ ì„œë¹„ìŠ¤ì— ì ìš©í•˜ê¸°ì— ê´œì°®ë‹¤ëŠ” ê²°ë¡ ì„ ë‚´ë ¸ìŠµë‹ˆë‹¤.</p>

<h4 id="44-spring-cloud-stream-binder-rabbit-120-release-ì†ŒìŠ¤-ë¶„ì„">4.4 Spring Cloud Stream Binder Rabbit 1.2.0 RELEASE ì†ŒìŠ¤ ë¶„ì„</h4>

<p>ë‚˜ë¦„ ìµœê·¼ ë²„ì „ì¸ <code class="language-plaintext highlighter-rouge">Release 1.2.0</code> ì„ ì‚´í´ë³¼ë ¤ê³  í•©ë‹ˆë‹¤. ìŠ¤í”„ë§ ë¶€íŠ¸ 1.5.2 ë²„ì „ì´ ìµœì†Œ ì ìš©ì´ ë””íœë˜ì‹œë¡œ ì ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
ì°¸ê³ ë¡œ, ì²˜ìŒë¶€í„° 1.2.0 ë²„ì „ì„ í™•ì¸í•˜ì§€ ì•Šì€ ì´ìœ ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ ë²„ì „ ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤. 
í”„ë¡œì íŠ¸ì˜ ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì˜ ì—…ê·¸ë ˆì´ë“œë¡œ ì¸í•´ì„œ í•´ë‹¹ ì„œë¹„ìŠ¤ì—ì„œ ìˆ˜ì • ë° í…ŒìŠ¤íŠ¸ í•´ì•¼ í•˜ëŠ” ë‚´ìš©ì´ ë§ì•„ì¡ŒìŠµë‹ˆë‹¤.</p>

<p><img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_scs_release_103_01.png" alt="Spring Cloud Stream 1.0.3 RELEASE" />
ê¸°ë³¸ì ì¸ connection, channel ë“± ì´ˆê¸° ì‘ì—…ì€ 1.0.3.RELEASE ì™€ ìœ ì‚¬í•©ë‹ˆë‹¤.</p>

<p><img src="/images/portal/post/2017-7-12-spring_cloud_stream_rabbitmq_02/20170610_scs_release_1_2_0.png" alt="Spring Cloud Stream 1.2.0 RELEASE" /></p>

<p>Exchange, í ìƒì„± ë° ë°”ì¸ë”© í•˜ëŠ” ë¡œì§ì€ 1.0.3.RELEASE ì™€ ë§ì´ ë³€ê²½ì´ ë˜ì—ˆê³  
ì£¼ìš” ë¡œì§ì€ RabbitExchangeQueueProvisioner -&gt; provisionConsumerDestination() ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binder</span><span class="o">.</span><span class="na">AbstractMessageChannelBinder</span>

<span class="kd">public</span> <span class="kd">final</span> <span class="nc">Binding</span><span class="o">&lt;</span><span class="nc">MessageChannel</span><span class="o">&gt;</span> <span class="nf">doBindConsumer</span><span class="o">(</span>
<span class="o">...</span>
    <span class="kd">final</span> <span class="nc">ConsumerDestination</span> <span class="n">destination</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">provisioningProvider</span><span class="o">.</span><span class="na">provisionConsumerDestination</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">group</span><span class="o">,</span> <span class="n">properties</span><span class="o">);</span>
<span class="o">...</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binder</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">provisioning</span><span class="o">.</span><span class="na">RabbitExchangeQueueProvisioner</span>


<span class="kd">public</span> <span class="nc">ConsumerDestination</span> <span class="nf">provisionConsumerDestination</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">group</span><span class="o">,</span> <span class="nc">ExtendedConsumerProperties</span><span class="o">&lt;</span><span class="nc">RabbitConsumerProperties</span><span class="o">&gt;</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
	<span class="kt">boolean</span> <span class="n">anonymous</span> <span class="o">=</span> <span class="o">!</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">group</span><span class="o">);</span>
	<span class="nc">String</span> <span class="n">baseQueueName</span> <span class="o">=</span> <span class="n">anonymous</span> <span class="o">?</span> <span class="n">groupedName</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="no">ANONYMOUS_GROUP_NAME_GENERATOR</span><span class="o">.</span><span class="na">generateName</span><span class="o">())</span>
			<span class="o">:</span> <span class="n">groupedName</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">group</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">isInfoEnabled</span><span class="o">())</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"declaring queue for inbound: "</span> <span class="o">+</span> <span class="n">baseQueueName</span> <span class="o">+</span> <span class="s">", bound to: "</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="nc">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">().</span><span class="na">getPrefix</span><span class="o">();</span>
	<span class="kd">final</span> <span class="nc">String</span> <span class="n">exchangeName</span> <span class="o">=</span> <span class="n">applyPrefix</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
	<span class="nc">Exchange</span> <span class="n">exchange</span> <span class="o">=</span> <span class="n">buildExchange</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(),</span> <span class="n">exchangeName</span><span class="o">);</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">().</span><span class="na">isDeclareExchange</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">declareExchange</span><span class="o">(</span><span class="n">exchangeName</span><span class="o">,</span> <span class="n">exchange</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="nc">String</span> <span class="n">queueName</span> <span class="o">=</span> <span class="n">applyPrefix</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">baseQueueName</span><span class="o">);</span>
	<span class="kt">boolean</span> <span class="n">partitioned</span> <span class="o">=</span> <span class="o">!</span><span class="n">anonymous</span> <span class="o">&amp;&amp;</span> <span class="n">properties</span><span class="o">.</span><span class="na">isPartitioned</span><span class="o">();</span>
	<span class="kt">boolean</span> <span class="n">durable</span> <span class="o">=</span> <span class="o">!</span><span class="n">anonymous</span> <span class="o">&amp;&amp;</span> <span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">().</span><span class="na">isDurableSubscription</span><span class="o">();</span>
	<span class="nc">Queue</span> <span class="n">queue</span><span class="o">;</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">anonymous</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Queue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">queueArgs</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(),</span> <span class="kc">false</span><span class="o">));</span>
	<span class="o">}</span>
	<span class="k">else</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">partitioned</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">String</span> <span class="n">partitionSuffix</span> <span class="o">=</span> <span class="s">"-"</span> <span class="o">+</span> <span class="n">properties</span><span class="o">.</span><span class="na">getInstanceIndex</span><span class="o">();</span>
			<span class="n">queueName</span> <span class="o">+=</span> <span class="n">partitionSuffix</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">durable</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Queue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span>
					<span class="n">queueArgs</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(),</span> <span class="kc">false</span><span class="o">));</span>
		<span class="o">}</span>
		<span class="k">else</span> <span class="o">{</span>
			<span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Queue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span>
					<span class="n">queueArgs</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">(),</span> <span class="kc">false</span><span class="o">));</span>
		<span class="o">}</span>
	<span class="o">}</span>
	<span class="n">declareQueue</span><span class="o">(</span><span class="n">queueName</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>
	<span class="nc">Binding</span> <span class="n">binding</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">().</span><span class="na">isBindQueue</span><span class="o">())</span> <span class="o">{</span>
		<span class="n">binding</span> <span class="o">=</span> <span class="n">declareConsumerBindings</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">properties</span><span class="o">,</span> <span class="n">exchange</span><span class="o">,</span> <span class="n">partitioned</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">durable</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">autoBindDLQ</span><span class="o">(</span><span class="n">applyPrefix</span><span class="o">(</span><span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">().</span><span class="na">getPrefix</span><span class="o">(),</span> <span class="n">baseQueueName</span><span class="o">),</span> <span class="n">queueName</span><span class="o">,</span>
				<span class="n">properties</span><span class="o">.</span><span class="na">getExtension</span><span class="o">());</span>
	<span class="o">}</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">RabbitConsumerDestination</span><span class="o">(</span><span class="n">queue</span><span class="o">,</span> <span class="n">binding</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>ì†ŒìŠ¤ë¥¼ ë³´ì‹œë©´ ìµìŠ¤ì²´ì¸ì§€ íƒ€ì… ê³¼ ë¼ìš°íŒ… í‚¤ë¥¼ Properties ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ 1.2.0.RELEASE ì—ì„œëŠ” (1.0.3.RELEASEë¹„êµí•˜ì—¬) ì•„ë˜ì™€ ê°™ì€ ì°¨ì´ì ì´ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ìµìŠ¤ì²´ì¸ì§€ íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ë°”ì¸ë”©í‚¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</li>
  <li>ë“±ë“± ë‚´ê°€ ëª¨ë¥´ëŠ” ë§ì€ ê¸°ëŠ¥ì´ ì ìš©ì´ ë˜ì—ˆë‹¤;</li>
</ul>

<p>ê²°êµ­ ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì„ ì˜¬ë¦¬ëŠ” RISK ë¥¼ ê°ì•ˆí•˜ê³  1.2.0.RELEASE ë¥¼ ì ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤ê³  íŒë‹¨í•˜ì˜€ìŠµë‹ˆë‹¤. 
ë¶€ë„ëŸ½ì§€ë§Œ í˜„ì¬ ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ì´â€¦ 1.1.3â€¦</p>

<h4 id="45-spring-cloud-stream-binder-rabbit-120-release-ì ìš©-í•´ë³´ê¸°">4.5 Spring Cloud Stream Binder Rabbit 1.2.0 RELEASE ì ìš© í•´ë³´ê¸°</h4>

<p>ì´ì œ ë“œë””ì–´ Spring Cloud Stream í”„ë¡œì íŠ¸ë¡œ RabbitMQ ë¥¼ ì—°ë™í•´ë´¤ìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">Gradle</code> ì— ë””íœë˜ì‹œ ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ìŠ¤í”„ë§ë¶€íŠ¸ ë²„ì „ë„ ì—…ê·¸ë ˆì´ë“œ í–ˆê¸° ë•Œë¬¸ì— boot ë²„ì „ë„ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">build</span><span class="o">.</span><span class="na">gradle</span>

<span class="n">dependencies</span> <span class="o">{</span>
	
	<span class="o">.</span>
	<span class="o">.</span>
	<span class="o">.</span>
	<span class="n">compile</span><span class="o">(</span><span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">cloud</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">cloud</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">stream</span><span class="o">-</span><span class="nl">rabbit:</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">0</span><span class="o">.</span><span class="na">RELEASE</span><span class="err">'</span><span class="o">)</span></code></pre></figure>

<p><code class="language-plaintext highlighter-rouge">Properties</code> ì„¤ì •ì„ ì¶”ê°€í•©ë‹ˆë‹¤. ì°¸ê³ ë¡œ ì„¤ì • ê´€ë ¨í•´ì„œëŠ” ë°˜ë“œì‹œ ë ˆí¼ëŸ°ìŠ¤ ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤. í•´ë‹¹ ì„¤ì •ì€ ì €í¬ í”„ë¡œì íŠ¸ í™˜ê²½ì— ë§ê²Œ ë³€ê²½ëœ ë‚´ìš©ì…ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-gradle" data-lang="gradle"><span class="n">application</span><span class="o">-</span><span class="n">dev</span><span class="o">.</span><span class="na">properties</span>

<span class="k">dependencies</span> <span class="o">{</span>
	
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">SINK</span><span class="o">-</span><span class="n">INPUT</span><span class="o">-</span><span class="n">TEST</span><span class="o">.</span><span class="na">destination</span><span class="o">=</span><span class="n">news</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">SINK</span><span class="o">-</span><span class="n">INPUT</span><span class="o">-</span><span class="n">TEST</span><span class="o">.</span><span class="na">group</span><span class="o">=</span><span class="err">ì„œë²„ì˜</span> <span class="err">ìœ ë‹ˆí¬í•œ</span> <span class="err">ê°’</span> <span class="err">ì„¤ì •</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">SINK</span><span class="o">-</span><span class="n">TEST</span><span class="o">.</span><span class="na">consumer</span><span class="o">.</span><span class="na">bindingRoutingKey</span><span class="o">=</span><span class="n">newsbox</span><span class="o">.</span><span class="na">update</span><span class="o">.</span><span class="na">test</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">SINK</span><span class="o">-</span><span class="n">TEST</span><span class="o">.</span><span class="na">consumer</span><span class="o">.</span><span class="na">exchangeType</span><span class="o">=</span><span class="n">direct</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">bindings</span><span class="o">.</span><span class="na">SINK</span><span class="o">-</span><span class="n">TEST</span><span class="o">.</span><span class="na">consumer</span><span class="o">.</span><span class="na">durableSubscription</span><span class="o">=</span><span class="kc">false</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">cloud</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">binders</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">type</span><span class="o">=</span><span class="n">rabbit</span>
	
	<span class="c1">//ì°¸ê³ ë¡œ rabbitMQ ê´€ë ¨ ì„¤ì • ì •ë³´ë¥¼ ë”°ë¡œ properties ì— ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">host</span><span class="o">=</span><span class="n">$</span><span class="o">{</span><span class="n">rabbitmq</span><span class="o">.</span><span class="na">host</span><span class="o">}</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">virtual</span><span class="o">-</span><span class="n">host</span><span class="o">=</span><span class="n">testhost</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">username</span><span class="o">=</span><span class="n">$</span><span class="o">{</span><span class="n">rabbitmq</span><span class="o">.</span><span class="na">username</span><span class="o">}</span>
	<span class="n">spring</span><span class="o">.</span><span class="na">rabbitmq</span><span class="o">.</span><span class="na">password</span><span class="o">=</span><span class="n">$</span><span class="o">{</span><span class="n">rabbitmq</span><span class="o">.</span><span class="na">password</span><span class="o">}</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">listener</span><span class="o">.</span><span class="na">java</span>
	
<span class="nd">@EnableBinding</span><span class="o">(*****</span><span class="nc">Listener</span><span class="o">.</span><span class="na">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="err">*****</span><span class="nc">Listener</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">News</span><span class="o">*****</span><span class="nc">Dao</span> <span class="n">news</span><span class="o">*****</span><span class="nc">Dao</span><span class="o">;</span>

    <span class="nd">@StreamListener</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">inboundTest</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">subscribe</span><span class="o">(</span><span class="nc">PojoTest</span> <span class="n">pojotest</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">if</span><span class="o">(</span><span class="n">pojotest</span><span class="o">.</span><span class="na">is</span><span class="o">***()){</span>
            
            <span class="c1">//ë‰´ìŠ¤ ì—…ë°ì´íŠ¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ </span>
           
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Sink</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">inboundTest</span> <span class="o">=</span> <span class="s">"SINK-TEST"</span><span class="o">;</span>

        <span class="nd">@Input</span><span class="o">(</span><span class="n">inboundTest</span><span class="o">)</span>
        <span class="nc">SubscribableChannel</span> <span class="o">*****</span><span class="nc">Listener</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>ë„ˆë¬´ ê°„ë‹¨í•˜ì§€ë§Œ ì´ê±¸ë¡œ ëì…ë‹ˆë‹¤.</p>

<h4 id="46-ì •ë¦¬">4.6 ì •ë¦¬</h4>

<p>Spring Cloud Stream ë¥¼ ì ìš©í•˜ì—¬ RabbitMQ ë¥¼ ì—°ë™í•˜ëŠ” ê³¼ì •ì„ ì •ë¦¬í•´ë´¤ìŠµë‹ˆë‹¤.
ë¶€ì¡±í•œ ì‹¤ë ¥ìœ¼ë¡œ í˜¼ìì„œ ì‚½ì§ˆì„ ë§ì´ í–ˆìŠµë‹ˆë‹¤. í˜¹ì‹œë¼ë„ í‹€ë¦° ë‚´ìš© ìˆê±°ë‚˜ ë‹¤ë¥¸ ì˜ê²¬ ìˆìœ¼ì‹œë©´ ê¼­ ë§ì”€ ë¶€íƒë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<blockquote>
  <p>ì²˜ìŒë¶€í„° 1.2.0.RELEASE ë²„ì „ì„ ê²€í†  í–ˆìœ¼ë©´ ì¢‹ì•˜ì„ ê²ƒì„â€¦â€¦â€¦â€¦.ã… ã…  ì–´ì¨‹ë“  í˜„ì¬ ì„œë¹„ìŠ¤ì— ì˜í–¥ì„ ìµœì†Œí™”í•˜ê³  ì‹¶ì–´ì„œ ë¶€íŠ¸ ë²„ì „ ì—…ê·¸ë ˆì´ë“œë¥¼ ì£¼ì €í–ˆì—ˆìŠµë‹ˆë‹¤.</p>
</blockquote>

<h1 id="5-ì¶”ê°€-ì‘ì—…">5. ì¶”ê°€ ì‘ì—…</h1>

<p>ê¸°ë³¸ì ì¸ ì—°ë™ì‘ì—… ì™¸ì— ì¶”ê°€ë¡œ ì‘ì—…í•œ ë‚´ìš©ì— ëŒ€í•´ì„œ ê³µìœ í•©ë‹ˆë‹¤.</p>

<h4 id="51-spring-boot-ë²„ì „-ì—…ê·¸ë ˆì´ë“œ">5.1 Spring Boot ë²„ì „ ì—…ê·¸ë ˆì´ë“œ</h4>

<p>Spring Cloud Stream 1.2.0.RELEASE ë¥¼ ì ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë²„ì „ì„ 1.5.2 ê¹Œì§€ ì—…ê·¸ë ˆì´ë“œ í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>í˜„ì¬ ìŠ¤í”„ë§ë¶€íŠ¸ì˜ ë²„ì „ì€ 1.1.X ë¡œ ë¹„êµì  ë‚®ì€ ë²„ì „ì´ ì ìš©ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤. 
ê·¸ë™ì•ˆ ìš´ì˜ì— í° ì§€ì¥ì€ ì—†ì—ˆìŠµë‹ˆë‹¤ë§Œ, ì´ë²ˆ ê¸°íšŒì— ë¶€íŠ¸ ë²„ì „ì„ 1.5.2 ë¡œ ì˜¬ë ¸ìŠµë‹ˆë‹¤. ì˜¬ë¦¬ë©´ì„œ ì§„í–‰í•œ ì‘ì—…ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<p>ì‘ì„± ì¤‘</p>

<h4 id="52-ì¥ì• ëŒ€ì‘-1shutdown-listener-ì—°ë™">5.2 [ì¥ì• ëŒ€ì‘-1]ShutDown listener ì—°ë™</h4>

<p>RabbitMQ ì˜ ì¥ì•  ë˜ëŠ” ê°•ì œ ì»¤ë„¥ì…˜ ì¢…ë£Œë¡œ ì¸í•œ ì…§ë‹¤ìš´ ë°œìƒ ì‹œ ì„œë¹„ìŠ¤ ëŒ€ì‘ ì‘ì—…ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. 
CachingConnectionFactory ì†ŒìŠ¤ë¥¼ ë³´ë©´ ì•„ë˜ ì†ŒìŠ¤ì²˜ëŸ¼ ì…§ë‹¤ìš´ì´ ë°œìƒí•˜ë©´ ë¡œê·¸ë§Œ ë‚¨ê¸°ë„ë¡ ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">amqp</span><span class="o">.</span><span class="na">rabbit</span><span class="o">.</span><span class="na">connection</span><span class="o">.</span><span class="na">CachingConnectionFactory</span>

<span class="o">.</span>
<span class="o">.</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdownCompleted</span><span class="o">(</span><span class="nc">ShutdownSignalException</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">this</span><span class="o">.</span><span class="na">closeExceptionLogger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">logger</span><span class="o">,</span> <span class="s">"Channel shutdown"</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>CachingConnectionFactory ë¥¼ ìƒì„±í•´ì£¼ëŠ” RabbitAutoConfiguration í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ @ConditionalOnMissingBean (ConnectionFactory.class) ë¡œ ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">.</span><span class="na">autoconfigure</span><span class="o">.</span><span class="na">amqp</span><span class="o">.</span><span class="na">RabbitAutoConfiguration</span>


<span class="nd">@Configuration</span>
	<span class="nd">@ConditionalOnMissingBean</span><span class="o">(</span><span class="nc">ConnectionFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="kd">protected</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RabbitConnectionFactoryCreator</span> <span class="o">{</span>

		<span class="nd">@Bean</span>
		<span class="kd">public</span> <span class="nc">CachingConnectionFactory</span> <span class="nf">rabbitConnectionFactory</span><span class="o">(</span><span class="nc">RabbitProperties</span> <span class="n">config</span><span class="o">)</span>
				<span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="o">.</span>
		<span class="o">.</span>
		<span class="o">.</span>
		<span class="c1">//ì‹¤ì œë¡œ ì´ ë¶€ë¶„ì„ ë³€ê²½í•  ê²ƒì…ë‹ˆë‹¤...</span>
		<span class="nc">CachingConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CachingConnectionFactory</span><span class="o">(</span>
					<span class="n">factory</span><span class="o">.</span><span class="na">getObject</span><span class="o">());</span></code></pre></figure>

<p>ê·¸ë˜ì„œ ì €ëŠ” CachingConnectionFactory Bean ìƒì„±í•˜ëŠ” ì†ŒìŠ¤ë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ 
ì‹ ê·œ í´ë˜ìŠ¤ë¡œ ì‘ì„±í•˜ì˜€ê³  CachingConnectionFactory ìƒì„±í•˜ëŠ” ë¶€ë¶„ì—ì„œ shutdownCompleted ë§Œ ì˜¤ë²„ë¼ì´ë“œ í–ˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">CachingConnectionFactory</span> <span class="nf">rabbitConnectionFactory</span><span class="o">(</span><span class="nc">RabbitProperties</span> <span class="n">config</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="c1">//ë¼ì´ë¸ŒëŸ¬ìŠ¤ ì†ŒìŠ¤ì™€ ë˜‘ê°™ì´ êµ¬í˜„</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="nc">CachingConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CachingConnectionFactory</span><span class="o">(</span><span class="n">factory</span><span class="o">.</span><span class="na">getObject</span><span class="o">()){</span>


            <span class="c1">//ì…§ë‹¤ì›ƒ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdownCompleted</span><span class="o">(</span><span class="nc">ShutdownSignalException</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>

                <span class="c1">//ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©</span>
                <span class="o">***</span><span class="nc">Dao</span><span class="o">.~~~;</span> 
                
                <span class="kd">super</span><span class="o">.</span><span class="na">shutdownCompleted</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="c1">//ë¼ì´ë¸ŒëŸ¬ë¦¬ ì†ŒìŠ¤ì™€ ë˜‘ê°™ì´</span>
		<span class="o">.</span></code></pre></figure>

<p>í˜¹ì‹œ ì´ëŸ° ë°©ë²•ì— ëŒ€í•´ì„œ ì˜ë¬¸ì ì´ë‚˜ ì˜ëª»ëœ ì‚¬í•­ì´ ìˆë‹¤ë©´ ê¼­ í”¼ë“œë°± ë¶€íƒë“œë¦½ë‹ˆë‹¤ã… ã… </p>

<h4 id="53-ì¥ì• ëŒ€ì‘-2ì»¤ë„¥ì…˜-ì‹¤íŒ¨-ë“±-ì¥ì• ìƒí™©ì—-ëŒ€í•œ-í…ŒìŠ¤íŠ¸">5.3 [ì¥ì• ëŒ€ì‘-2]ì»¤ë„¥ì…˜ ì‹¤íŒ¨ ë“± ì¥ì• ìƒí™©ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸</h4>

<p>ì¥ì•  ìƒí™©ì— ëŒ€í•´ì„œ ì—¬ëŸ¬ê°€ì§€ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë´¤ìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì²˜ìŒ ì˜¬ë¦¬ëŠ” ê²½ìš°</code></p>

<ul>
  <li>MQ ì„œë²„ ë„¤íŠ¸ì›ì´ ëŠê¸´ ê²½ìš° -&gt;ë¶€íŠ¸ ì˜¬ë¼ì˜´, ë‹¨ ì»¤ë„¥ì…˜íƒ€ì„ì•„ì›ƒì´ 60ì´ˆë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ</li>
  <li>MQ ì„œë²„ëŠ” ì •ìƒì´ì§€ë§Œ RabbitMQ ì¤‘ì§€ëœ ê²½ìš° -&gt; ë¶€íŠ¸ ì˜¬ë¼ì˜´</li>
  <li>ì„¤ì •ëœ vhost ì •ë³´ê°€ ì˜ëª»ëœ ê²½ìš° -&gt; ë¶€íŠ¸ ì˜¬ë¼ì˜´</li>
  <li>ì„¤ì •ëœ rabbitmq.password ê°€ ì˜ëª»ëœ ê²½ìš° -&gt; ë¶€íŠ¸ ì•ˆì˜¬ë¼ì˜´</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ì˜¬ë¼ì™€ ìˆëŠ” ì„œë¹„ìŠ¤ ì¤‘ ìƒí™©ì—ì„œ</code></p>

<ul>
  <li>ê°‘ìê¸° MQ ì„œë²„ ë„¤íŠ¸ì›Œì´ ëŠê¸´ ê²½ìš° -&gt; ì»¤ë„¥ì…˜ ëŠê¸°ì§€ë§Œ ì„œë¹„ìŠ¤ ì§€ì¥ ì—†ìŒ, MQ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë˜ë©´ ìë™ ì»¤ë„¥ì…˜ ë§ºìŒ</li>
  <li>RabbitMQ ê´€ë¦¬íˆ´ì—ì„œ ì»¤ë„¥ì…˜ì„ ê°•ì œë¡œ ì¤‘ì§€í•œ ê²½ìš° -&gt; ì¬ì—°ê²° ë¨</li>
  <li>(ê·¸ëŸ´ë¦¬ê°€ ì—†ê² ì§€ë§Œ)ê´€ë¦¬ìê°€ ê°‘ìê¸° exchange ë¥¼ ì œê±°í•œ ê²½ìš° -&gt; ???</li>
</ul>

<p>ê¸°íƒ€ ìƒí™©ì— ëŒ€í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¸ ê²°ê³¼ ì„œë¹„ìŠ¤ì— í¬ê²Œ ì§€ì¥ë  ë§Œí•œ ì‚¬í•­ì€ ì—†ëŠ” ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ì—ˆìŠµë‹ˆë‹¤. 
ëˆ„êµ°ê°€ê°€ MQì˜ ë¹„ë²ˆì„ ê°‘ìê¸° ë°”ê¿€ ê²½ìš°ë„ ì—†ì„ í…Œê³ â€¦</p>

<p>ë‹¨ ë„¤íŠ¸ì›Œí¬ê°€ ëŠê²¼ì„ ê²½ìš° ê°‘ìê¸° ë¶€íŠ¸ë¥¼ ì˜¬ë ¤ì•¼ í•˜ëŠ” ìƒí™©ì´ë¼ë©´ ì‚¬ì‹¤ 60ì´ˆì˜ ì»¤ë„¥ì…˜ì€ ë„ˆë¬´ ê¸¸ê²Œ ëŠê»´ì§ˆìˆ˜ëŠ” ìˆìŠµë‹ˆë‹¤.
MQ ì„œë²„ë¡œì˜ ì¥ì• ì™€ ìƒê´€ì—†ì´ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë¹ ë¥´ê²Œ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ì™€ì•¼ í•©ë‹ˆë‹¤. 
(ì°¸ê³ ë¡œ MQ ê°€ ì—°ë™ì´ ë˜ì§€ ì•Šìœ¼ë©´ ê¸°ì¡´ ë¡œì§(ë‰´ìŠ¤ê¸°ì‚¬ê°€ API ì—°ë™)ì´ ì‘ë™í•©ë‹ˆë‹¤. ì…§ë‹¤ìš´ ëì„ë•Œë„ ë§ˆì°¬ê°€ì§€ë¡œ ëŒ€ì‘ ë¡œì§ì´ ì ìš©ë©ë‹ˆë‹¤.)</p>

<p>ì–´ì¨‹ë“  CachingConnectionFactory ì„ ì–¸í•œ ë¶€ë¶„ì—ì„œ ì•„ë˜ì™€ ê°™ì´ ì´ˆê¸° ì—°ê²°ì‹œ íƒ€ì„ì•„ì›ƒì„ 3ì´ˆë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">CachingConnectionFactory</span> <span class="nf">rabbitConnectionFactory</span><span class="o">(</span><span class="nc">RabbitProperties</span> <span class="n">config</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">.</span>
        <span class="o">.</span>
        <span class="c1">//ë¼ì´ë¸ŒëŸ¬ìŠ¤ ì†ŒìŠ¤ì™€ ë˜‘ê°™ì´ êµ¬í˜„</span>
        <span class="o">.</span>
        <span class="o">.</span>
	<span class="c1">//íŒ©í† ë¦¬ ìƒì„± ì´í›„ì— ë¡œì§ì— ì¶”ê°€</span>
	<span class="c1">//ì´ˆê¸° ì—°ê²° ì‹œ íƒ€ì´ì•„ì›ƒ 60ì´ˆ -&gt; 3ì´ˆ</span>
	<span class="n">connectionFactory</span><span class="o">.</span><span class="na">setConnectionTimeout</span><span class="o">(</span><span class="mi">3000</span><span class="o">);</span></code></pre></figure>

<h4 id="53-ha-or-l4-êµ¬ì„±-ë°-í´ëŸ¬ìŠ¤í„°ë§-ê²€í† ">5.3 HA or L4 êµ¬ì„± ë° í´ëŸ¬ìŠ¤í„°ë§ ê²€í† </h4>

<p>HAêµ¬ì„±ì„ ê²€í† í•˜ì˜€ìœ¼ë‚˜ ì„œë²„ ë‹´ë‹¹ìì™€ ë…¼ì˜ ëì— L4 Active/Standby ì´ì¤‘í™” êµ¬ì„±ì„ í•˜ì˜€ìŠµë‹ˆë‹¤. (ë¡œë“œ ë°¸ëŸ°ì‹± ì•„ë‹˜!!)
ê·¸ë¦¬ê³  ê³ ë¯¼ì„ ë§ì´ í–ˆì§€ë§Œ í•´ë‹¹ Message ì •ë³´ëŠ” ìœ ì‹¤ë˜ì–´ë„ ìƒê´€ì—†ëŠ” ì •ë³´ì´ê¸° ë•Œë¬¸ì— í´ëŸ¬ìŠ¤í„°ë§ ì—†ì´ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
ì¼ë°˜ì ìœ¼ë¡œëŠ” í´ëŸ¬ìŠ¤í„°ë§ êµ¬ì„±í•´ì„œ ì§„í–‰í•˜ê² ì§€ë§Œ, ì¶”í›„ì— ê²€í† í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p>

<p>MQ ì„œë²„ 1 ë²ˆì— L4 ë¥¼ í†µí•´ì„œ ì—°ê²°ë˜ì–´ ìˆëŠ” ìƒí™©ì—ì„œ ê°‘ì‘ìŠ¤ëŸ½ê²Œ MQì„œë²„1 ì´ ì£½ìœ¼ë©´ ìë™ìœ¼ë¡œ L4 ì—ì„œ Standby ì„œë²„ì¸ Mq 2ë²ˆ ì„œë²„ë¡œ ì¬ì—°ê²° í•©ë‹ˆë‹¤.
ì„œë²„1ì˜ íëŠ” ìë™ìœ¼ë¡œ ì‚­ì œ ë˜ê³  MQ2 ì— ì‹ ê·œ íê°€ ìƒì„±ì´ ë©ë‹ˆë‹¤.</p>

<p>ì°¸ê³ ë¡œ Spring Cloud Stream ìœ¼ë¡œ ì—°ë™ë˜ëŠ” íëŠ” AutoDelete ì„¤ì •ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<h1 id="6-ì •ë¦¬">6. ì •ë¦¬</h1>

<p>ì‹œê°„ì´ ì—†ì–´ì„œ ì£¼ì €ë¦¬ì£¼ì €ë¦¬ ì‘ì„±í•´ë´¤ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ì‹œê°„ì´ ëœë‹¤ë©´ ê¹”ë”í•˜ê²Œ ê¸€ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤.</p>

<p>ì•”íŠ¼ ì„œë¹„ìŠ¤ ì ìš© ì „ì— í”¼ë“œë°±ì„ ë°›ê³  ì‹¶ì–´ì„œ ë¶€ë„ëŸ½ì§€ë§Œ ìš©ê¸°ë¥¼ ë‚´ì„œ ê³µìœ ë¥¼ í•´ë´…ë‹ˆë‹¤. 
ì¢‹ì€ ì˜ê²¬ ìˆìœ¼ì‹œë©´ ê¼­ ë§ì”€ ë¶€íƒë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>

<p>í—ˆì ‘í•˜ì§€ë§Œ ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ, ê°ì‚¬í•©ë‹ˆë‹¤.</p>
:ET