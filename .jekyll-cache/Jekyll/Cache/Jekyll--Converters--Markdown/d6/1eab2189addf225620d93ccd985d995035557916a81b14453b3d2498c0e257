I"A¶<h1 id="ìŠ¤í”„ë§ì„-ë§›ë³´ë‹¤">ìŠ¤í”„ë§ì„ ë§›ë³´ë‹¤</h1>
<h2 id="1-ê²Œì‹œíŒ">1. ê²Œì‹œíŒ</h2>
<p>íŒŒì¼ëŸ¿ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ë©´ A4ìš©ì§€ê°€ í•œ ì¥ ì£¼ì–´ì§‘ë‹ˆë‹¤. ì£¼ì–´ì§„ ë‚´ìš©ì€ ë°”ë¡œ</p>

<p>í•„ìˆ˜ ìŠ¤í™
-Java8
-STS(intellij)
-Spring 4.0 MVC
-Spring Security
-ORM(Hibernate ë“±)
-Git
-MySQL
-Log4j
-Springboot
-Gradle
-jQuery</p>

<p>ì„ íƒ ìŠ¤í™
-Freemarker
-Ajax
-JUnit
-Node.js
-Backbone.js
-BootStrap
-ë¹Œë“œ ì‹œìŠ¤í…œ(grunt)
-ë‹¤ì–‘í•œ Spring Annotation
-ë‹¤ì–‘í•œ Design Pattern
-ë‹¤ì–‘í•œ opensource, framework</p>

<p>Spring frameworkë¥¼ ì²˜ìŒ ì ‘í•´ë³´ëŠ” ì €ëŠ” ë°”ë¡œ ë©˜ë¶•ì— ë¹ ì ¸ë²„ë ¸ìŠµë‹ˆë‹¤..
<img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/IMG_1521.JPG" alt="ë³€ëª…ì€ ì§€ì˜¥ì—ì„œ ë“£ì§€" /></p>

<p>ì—¬ëŸ¬ê°€ì§€ ì„ íƒ ìŠ¤í™ì´ ìˆì—ˆì§€ë§Œ, Freemarkerê°€ ê¶ê¸ˆí•˜ì—¬ ì°¾ì•„ë³´ì•˜ëŠ”ë° servletì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ë“¤ì„ ì´ìš©í•˜ì—¬ HTMLì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ëŠ” í…œí”Œë¦¿ ì—”ì§„ì´ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Freemarkerê°€ ì™œ ì„ íƒ ìŠ¤í™ì— ìˆëŠ”ê°€?? JSPëŠ” ì´ë¯¸ ì—…ë°ì´íŠ¸ê°€ ì¤‘ë‹¨ë˜ì—ˆê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.. ê·¸ë˜ì„œ ì €ëŠ” ê³¼ê°í•˜ê²Œ Freemarkerë¥¼ ì„ íƒí•˜ì˜€ê³  ì„ íƒ ìŠ¤í™ì—ëŠ” ë‚˜ì™€ìˆì§€ ì•Šì§€ë§Œ front-end ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ë¥¼ ìœ„í•´ bowerë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>

<p><strong>bowerë€..</strong>
A package manager for the webì´ë¼ê³  ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. front-end ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ jQueryë‚˜ BootStrap ë“±ì„ ê°„í¸í•˜ê²Œ ê´€ë¦¬í•˜ê³  ì„¤ì¹˜(ê²°êµ­ ê·€ì°®ìŒì„ ì¤„ì´ê¸° ìœ„í•´..)í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<p>Spring frameworkë¥¼ ì¨ë³´ë©´ì„œ ê°€ì¥ í—¤ë§¸ë˜ ê²ƒì€ <strong>Spring Security, hibernate</strong>ì…ë‹ˆë‹¤.</p>

<p><strong>ë¡œê·¸ì¸ë¶€í„° ì„¸ì…˜ê´€ë¦¬ê¹Œì§€ ë„ˆì—ê²Œ ë§¡ê¸´ë‹¤. Spring Security</strong></p>

<p>ì²˜ìŒ Spring Securityë¥¼ ë³´ê³  ë­˜ ë³´ì•ˆí•´ì¤€ë‹¤ëŠ” ê±°ì§€..ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆì§€ë§Œ Springì—ì„œ ì œê³µí•´ì£¼ëŠ” ì—„ì²­ë‚œ ê¸°ëŠ¥ë“¤ì´..!
Spring SecurityëŠ” ì½”ë“œ ëª‡ ì¤„ë¡œ Enterpriseê¸‰ ì›¹ ì„œë¹„ìŠ¤ë„ ë¹µë¹µí•œ ë³´ì•ˆì„ ì§€ì›í•´ì¤ë‹ˆë‹¤!
ê°„ë‹¨í•œ íë¦„ì„ ë³´ìë©´ <code class="language-plaintext highlighter-rouge">"Authentication(ì¸ì¦) í›„ ê°ìì˜ role(user, admin ë“±..)ì— ë§ê²Œ Authorization(ê¶Œí•œ)ì„ ë°›ëŠ”ë‹¤."</code>ì…ë‹ˆë‹¤. customí•œ Spring Securityë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ UserDetailsì™€ UserDetailsServiceë¥¼ ìƒì†ë°›ì•„ ì… ë§›ì— ë§ê²Œ ë°”ê¾¸ì–´ì£¼ë©´ ë˜ëŠ” ì•„ì£¼ ê°„ë‹¨í•˜ê³  ê°•ë ¥í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>

<p><strong>ì§€ì˜¥ì˜ hibernate</strong></p>

<p>ORMì´ë€?? <strong>Object Relational Mapping</strong>
ì˜ ì•½ìë¡œ</p>
<blockquote>
  <p>ë°ì´í„°ë² ì´ìŠ¤ì™€ ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ê°„ì˜ í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì…ë‹ˆë‹¤.
ëŒ€í‘œì ì¸ ORM êµ¬í˜„ì²´ì¸ hibernateì˜ ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ë³´ë©´</p>
</blockquote>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Autowired</span> <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveUser</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">().</span><span class="na">saveOrUpdate</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>queryë¥¼ ì§œì§€ ì•Šê³  ë” ì§ê´€ì ìœ¼ë¡œ DBì— ì ‘ê·¼ì„..!</p>

<p>Hibernateì˜ ì¥ì ìœ¼ë¡œëŠ”</p>
<ol>
  <li>ê°ì²´ ì§€í–¥ì ì¸ ì½”ë“œë¡œ ì§ê´€ì ì´ê³  ì¬ì‚¬ìš© ë° ìœ ì§€ë³´ìˆ˜ì˜ í¸ë¦¬ì„±ì´ ì¦ê°€í•œë‹¤.</li>
  <li>DBì— ì¢…ì†ì ì´ì§€ ì•Šë‹¤.</li>
</ol>

<p>Hibernateì˜ í•µì‹¬ì€ ì–‘ë°©í–¥ ê´€ê³„ ë§µí•‘ì´ë¼ê³  í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì‹¤ì œ DBì— FKë¥¼ ê±¸ì§€ ì•Šì•„ë„ Annotationë§Œìœ¼ë¡œ í…Œì´ë¸”ì˜ ê´€ê³„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆê³  ë‹¹ì¥ì— í•„ìš”ì—†ëŠ” ë°ì´í„°ì— ëŒ€í•´ì„œëŠ” FetchType(EAGER, <code class="language-plaintext highlighter-rouge">LAZY</code>)ì„ ì„¤ì •í•˜ì—¬ í•„ìš”í•  ë•Œ ì§€ì—°ë¡œë”©ì„ í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” <strong>ê¿€</strong>
ê¸°ëŠ¥ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>

<p>ë˜í•œ ì—¬ëŸ¬ê°€ì§€ Annotationì„ ì œê³µí•˜ëŠ”ë°</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@SafeHtmlì€</span> <span class="n">í•„ë“œì—</span> <span class="nc">Annotationì„</span> <span class="n">ë¶™ì´ëŠ”</span> <span class="n">ê²ƒ</span> <span class="n">ë§Œìœ¼ë¡œ</span> <span class="no">XSS</span> <span class="n">ê³µê²©ì„</span> <span class="n">ë§‰ì„</span> <span class="n">ìˆ˜</span> <span class="n">ìˆë„ë¡</span> <span class="n">íƒœê·¸ë¥¼</span> <span class="n">ë³€í™˜í•´</span> <span class="n">ì¤ë‹ˆë‹¤</span><span class="o">.</span>
<span class="n">ì´</span> <span class="n">ì™¸ì—ë„</span> <span class="nd">@Length</span><span class="o">,</span> <span class="nd">@NotEmpty</span> <span class="n">ë“±ì„</span> <span class="n">ì§€ì •í•˜ì—¬</span> <span class="n">ê°’ì—</span> <span class="n">ëŒ€í•œ</span> <span class="n">validationì„</span> <span class="n">í•´ì¤ë‹ˆë‹¤</span><span class="o">.</span></code></pre></figure>

<p><strong>ê·¸ë¦¬ê³  2ì£¼ í›„.. ëŒ€ë§ì˜ ì½”ë“œ ë¦¬ë·°</strong></p>

<p><img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/IMG_1525.JPG" alt="ì‹ ì„ í•œ ë‰´ë¹„" /></p>

<ol>
  <li>Exception ì²˜ë¦¬</li>
  <li>Userì˜ PKë¥¼ integerë¡œ</li>
  <li>Javascript ì½”ë“œ ë¶„ë¦¬</li>
  <li>Require js (ëª¨ë“ˆí™”)</li>
  <li>Handlebars ë“±â€¦ ìˆ˜ë§ì€ ìˆ˜ì •ì‚¬í•­ì„ ë‚¨ê¸°ê³  ì„ ì„ë“¤ì€ ë– ë‚˜ê°€ì…¨ìŠµë‹ˆë‹¤..</li>
</ol>

<h2 id="2-ì†Œì…œëŒ“ê¸€">2. ì†Œì…œëŒ“ê¸€</h2>
<p>2ì°¨ íŒŒì¼ëŸ¿ í”„ë¡œì íŠ¸ ì§„í–‰í•œ ê²ƒì€ ë°”ë¡œ ì†Œì…œëŒ“ê¸€ì…ë‹ˆë‹¤!</p>

<p>ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤í™ìœ¼ë¡œëŠ”
-Springboot
-OAuth 1.0
-OAuth 2.0
-Freemarker
-Handlebars
ë“±ì´ ìˆìŠµë‹ˆë‹¤.</p>

<h3 id="ì„¤ê³„ë„">ì„¤ê³„ë„</h3>

<p>ë¯¸í¡í•œ ì‹¤ë ¥ìœ¼ë¡œë‚˜ë§ˆ íë¦„ë§Œ ì„¤ê³„ë¥¼ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. (ë¯¼ë§)
<img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/social_blueprint1.PNG" alt="ì†Œì…œëŒ“ê¸€ ì„¤ê³„" /></p>

<p><strong>ë‚´ ë§˜ëŒ€ë¡œ ê³ ë¥´ëŠ” í•µì‹¬</strong></p>
<ol>
  <li>Spring Social</li>
  <li>Spring Security oAuth</li>
</ol>

<p>Spring Socialì—ì„œëŠ” ë‹¨ìˆœí•œ ë°©ë²•ìœ¼ë¡œ OAuth1ê³¼ OAuth2ë¥¼ ì§€ì›í•´ì¤ë‹ˆë‹¤.
<strong>ì°¸ê³ ë¡œ facebookì€ OAuth2ì´ê³  twitterëŠ” OAuth1ì…ë‹ˆë‹¤.</strong></p>

<p>Springì—ì„œ ì œê³µí•´ì£¼ëŠ” ê¸°ëŠ¥ì´ë¼ ë¯¿ì„ë§Œí•˜ê³  í¸í•˜ì§€ë§Œ Spring Social coreì—ì„œ ì§€ì›í•˜ëŠ” OAuthë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì•„ë˜ì˜ DB ìŠ¤í‚¤ë§ˆë¥¼ ë¬´ì¡°ê±´ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.(<strong>ì‹¬ì§€ì–´ í…Œì´ë¸”ëª…(UserConnection)ê³¼ PK(userid, providerid, provideruserid)ê¹Œì§€ ì •í•´ì ¸ ìˆìŠµë‹ˆë‹¤.</strong>)</p>

<p><img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/social_schema1.PNG" alt="ì†Œì…œ ìŠ¤í‚¤ë§ˆ" /></p>

<p>ì†Œì…œ ëŒ“ê¸€ì„ ê°œë°œí•˜ë©´ì„œ ë§ì€ ì‚½ì§ˆì„ í–ˆìŠµë‹ˆë‹¤â€¦</p>

<p>ê°€ì¥ ë¨¼ì € ì‹œë„í–ˆë˜ ë°©ë²•ì€ Spring Socialì„ ì´ìš©í•œ ì¸ì¦ ë° ê³µìœ  ë°©ë²•ì…ë‹ˆë‹¤.
ë³„ë„ì˜ DB ìŠ¤í‚¤ë§ˆì— ëŒ€í•œ ì œì•½ì€ ì—†ì—ˆì§€ë§Œ ì½”ë“œê°€ ë‚œì¡í•´ì§€ëŠ” íš¨ê³¼ê°€ ìˆì—ˆìŠµë‹ˆë‹¤..</p>

<p>ì•„ë˜ì˜ ì½”ë“œì—ì„œëŠ” facebookì„ í†µí•˜ì—¬ ë¡œê·¸ì¸í•˜ì˜€ì„ ë•Œ ë°›ëŠ” ê¶Œí•œì„ ëª…ì‹œí•˜ì—¬ callback urlë¡œ ê¶Œí•œ ë“±ì˜ ì •ë³´ê°€ í¬í•¨ëœ access tokenê³¼ ë°”ê¿€ ìˆ˜ ìˆëŠ” codeë¥¼ parameterë¡œ ë°›ê²Œ ë©ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="nc">OAuth2Operations</span> <span class="n">oAuth2Operations</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">OAuth2Parameters</span> <span class="n">oAuth2Parameters</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">fbCallbackUrl</span> <span class="o">=</span> <span class="s">"callback ë°›ì„ url"</span><span class="o">;</span>
<span class="kd">private</span> <span class="nc">FacebookConnectionFactory</span> <span class="n">facebookConnectionFactory</span><span class="o">;</span>

<span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/fb"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">facebook</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">res</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
  <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"í˜ì´ìŠ¤ë¶ ì—°ë™"</span><span class="o">);</span>

  <span class="n">facebookConnectionFactory</span> <span class="o">=</span> <span class="o">(</span><span class="nc">FacebookConnectionFactory</span><span class="o">)</span> <span class="n">connectionFactoryLocator</span><span class="o">.</span><span class="na">getConnectionFactory</span><span class="o">(</span><span class="nc">Facebook</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
  <span class="n">oAuth2Operations</span> <span class="o">=</span> <span class="n">facebookConnectionFactory</span><span class="o">.</span><span class="na">getOAuthOperations</span><span class="o">();</span>
  <span class="n">oAuth2Parameters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuth2Parameters</span><span class="o">();</span>
  <span class="n">oAuth2Parameters</span><span class="o">.</span><span class="na">setScope</span><span class="o">(</span><span class="s">"email, public_profile, publish_actions"</span><span class="o">);</span>
  <span class="n">oAuth2Parameters</span><span class="o">.</span><span class="na">setRedirectUri</span><span class="o">(</span><span class="n">fbCallbackUrl</span><span class="o">);</span>

  <span class="nc">String</span> <span class="n">authorizeUrl</span> <span class="o">=</span> <span class="n">oAuth2Operations</span><span class="o">.</span><span class="na">buildAuthorizeUrl</span><span class="o">(</span><span class="nc">GrantType</span><span class="o">.</span><span class="na">AUTHORIZATION_CODE</span><span class="o">,</span> <span class="n">oAuth2Parameters</span><span class="o">);</span>
  <span class="n">res</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">authorizeUrl</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>codeë¥¼ ë°›ì•˜ë‹¤ë©´ ì´ì œ exchangeForAccess í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì‹¤ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” tokenìœ¼ë¡œ êµí™˜í•©ë‹ˆë‹¤.
ê·¸ë¦¬ê³  tokenì˜ ë§Œë£Œ ê¸°ê°„ì„ í™•ì¸ í›„ ë§Œë£Œë˜ì—ˆìœ¼ë©´ ê°±ì‹ ì„, ë§Œë£Œë˜ì§€ ì•Šì•˜ìœ¼ë©´ tokenì„ ì´ìš©í•´ connectionì„ ë§ºì€ í›„ callbackì„ ë°›ê¸° ì´ì „ì˜ í•¨ìˆ˜ì—ì„œ setScopeë¡œ ì§€ì •í•´ ì£¼ì—ˆë˜ ê¶Œí•œ ë²”ìœ„ ì•ˆì—ì„œ í•´ë‹¹ ìœ ì €ì— ëŒ€í•´ facebook APIë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/fbcallback"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">fbCallback</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">res</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
  <span class="nc">AccessGrant</span> <span class="n">accessGrant</span> <span class="o">=</span> <span class="n">oAuth2Operations</span><span class="o">.</span><span class="na">exchangeForAccess</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">fbCallbackUrl</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

  <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"access token {}"</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">);</span>

  <span class="cm">/**í† í° ë§Œë£Œ ê¸°ê°„ í™•ì¸*/</span>
  <span class="nc">Long</span> <span class="n">expiredTime</span> <span class="o">=</span> <span class="n">accessGrant</span><span class="o">.</span><span class="na">getExpireTime</span><span class="o">();</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">expiredTime</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">expiredTime</span> <span class="o">&lt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">())</span> <span class="o">{</span>
      <span class="n">accessToken</span> <span class="o">=</span> <span class="n">accessGrant</span><span class="o">.</span><span class="na">getRefreshToken</span><span class="o">();</span>
      <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"token refresh {}"</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="nc">Connection</span><span class="o">&lt;</span><span class="nc">Facebook</span><span class="o">&gt;</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">facebookConnectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">(</span><span class="n">accessGrant</span><span class="o">);</span>
  <span class="nc">Facebook</span> <span class="n">facebook</span> <span class="o">=</span> <span class="n">connection</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">connection</span><span class="o">.</span><span class="na">getApi</span><span class="o">()</span> <span class="o">:</span> <span class="k">new</span> <span class="nc">FacebookTemplate</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
  <span class="nc">FacebookLink</span> <span class="n">link</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FacebookLink</span><span class="o">(</span><span class="s">"http://zum.com/#!/v=2&amp;tab=home&amp;p=3&amp;cm=newsbox&amp;news=0372016112834507815"</span><span class="o">,</span> <span class="s">"news"</span><span class="o">,</span> <span class="s">"í…ŒìŠ¤íŠ¸"</span><span class="o">,</span> <span class="s">"í…ŒìŠ¤íŠ¸ ëŒ“ê¸€ì…ë‹ˆë‹¤."</span><span class="o">);</span>
  <span class="n">facebook</span><span class="o">.</span><span class="na">feedOperations</span><span class="o">().</span><span class="na">postLink</span><span class="o">(</span><span class="s">"í…ŒìŠ¤íŠ¸.."</span><span class="o">,</span> <span class="n">link</span><span class="o">);</span>
  <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>íŠ¸ìœ„í„°ì˜ ê²½ìš° ë¡œê·¸ì¸ì— í•œí•˜ì—¬ OAuth2ë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ê¸€ì„ ê³µìœ í•˜ê¸° ìœ„í•´ì„œ OAuth1ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
íŠ¸ìœ„í„° ì—­ì‹œ í˜ì´ìŠ¤ë¶ê³¼ ë¹„ìŠ·í•œ íë¦„ìœ¼ë¡œ í˜ëŸ¬ê°€ì§€ë§Œ ì°¨ì´ì ì€ OAuth ë²„ì „ì˜ ì°¨ì´ì…ë‹ˆë‹¤!</p>

<p>ë‘ ë²ˆì§¸ë¡œ ì‹œë„í–ˆë˜ ë°©ë²•ì€ SocialConfigurerë¥¼ ì´ìš©í•œ ë°©ë²•ì…ë‹ˆë‹¤. addConnectionFactories methodë¥¼ overrideí•˜ì—¬ app keyì™€ app secretì„ ë“±ë¡í•œ í›„ UsersConnectionRepositoryë¥¼ í†µí•´ DBì— ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addConnectionFactories</span><span class="o">(</span><span class="nc">ConnectionFactoryConfigurer</span> <span class="n">connectionFactoryConfigurer</span><span class="o">,</span> <span class="nc">Environment</span> <span class="n">environment</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">connectionFactoryConfigurer</span><span class="o">.</span><span class="na">addConnectionFactory</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">FacebookConnectionFactory</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"facebook.app-id"</span><span class="o">),</span> <span class="n">environment</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"facebook.app-secret"</span><span class="o">)));</span>

  <span class="n">connectionFactoryConfigurer</span><span class="o">.</span><span class="na">addConnectionFactory</span><span class="o">(</span>
  <span class="k">new</span> <span class="nf">TwitterConnectionFactory</span><span class="o">(</span><span class="n">environment</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"twitter.app-id"</span><span class="o">),</span> <span class="n">environment</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"twitter.app-secret"</span><span class="o">)));</span>
<span class="o">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="nc">UsersConnectionRepository</span> <span class="nf">getUsersConnectionRepository</span><span class="o">(</span><span class="nc">ConnectionFactoryLocator</span> <span class="n">connectionFactoryLocator</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">JdbcUsersConnectionRepository</span> <span class="n">repository</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JdbcUsersConnectionRepository</span><span class="o">(</span><span class="n">dataSource</span><span class="o">,</span> <span class="n">connectionFactoryLocator</span><span class="o">,</span> <span class="nc">Encryptors</span><span class="o">.</span><span class="na">noOpText</span><span class="o">());</span>
  <span class="n">repository</span><span class="o">.</span><span class="na">setConnectionSignUp</span><span class="o">(</span><span class="n">connection</span> <span class="o">-&gt;</span> <span class="n">connection</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">getProviderUserId</span><span class="o">());</span>
  <span class="k">return</span> <span class="n">repository</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>ì´ ê³¼ì •ì—ì„œ fieldê°€ ë°”ë€Œì–´ì„œ facebook profileì„ ì œëŒ€ë¡œ ë°›ì•„ì˜¤ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
<img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/say.jpg" alt="ì£¼ë¥µ" />
ê²°êµ­ PostConstructì™€ reflectionì„ ì´ìš©í•˜ì—¬ fieldë¥¼ ì¬ì •ì˜í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.(íœ´)</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@PostConstruct</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">String</span><span class="o">[]</span> <span class="n">fields</span> <span class="o">=</span> <span class="o">{</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"about"</span><span class="o">,</span> <span class="s">"age_range"</span><span class="o">,</span>
                    <span class="s">"birthday"</span><span class="o">,</span> <span class="s">"context"</span><span class="o">,</span> <span class="s">"cover"</span><span class="o">,</span>
                    <span class="s">"currency"</span><span class="o">,</span> <span class="s">"devices"</span><span class="o">,</span> <span class="s">"education"</span><span class="o">,</span>
                    <span class="s">"email"</span><span class="o">,</span> <span class="s">"favorite_athletes"</span><span class="o">,</span> <span class="s">"favorite_teams"</span><span class="o">,</span>
                    <span class="s">"first_name"</span><span class="o">,</span> <span class="s">"gender"</span><span class="o">,</span> <span class="s">"hometown"</span><span class="o">,</span>
                    <span class="s">"inspirational_people"</span><span class="o">,</span> <span class="s">"installed"</span><span class="o">,</span> <span class="s">"install_type"</span><span class="o">,</span>
                    <span class="s">"is_verified"</span><span class="o">,</span> <span class="s">"languages"</span><span class="o">,</span> <span class="s">"last_name"</span><span class="o">,</span>
                    <span class="s">"link"</span><span class="o">,</span> <span class="s">"locale"</span><span class="o">,</span> <span class="s">"location"</span><span class="o">,</span>
                    <span class="s">"meeting_for"</span><span class="o">,</span> <span class="s">"middle_name"</span><span class="o">,</span> <span class="s">"name"</span><span class="o">,</span>
                    <span class="s">"name_format"</span><span class="o">,</span> <span class="s">"political"</span><span class="o">,</span> <span class="s">"quotes"</span><span class="o">,</span>
                    <span class="s">"payment_pricepoints"</span><span class="o">,</span> <span class="s">"relationship_status"</span><span class="o">,</span> <span class="s">"religion"</span><span class="o">,</span>
                    <span class="s">"security_settings"</span><span class="o">,</span> <span class="s">"significant_other"</span><span class="o">,</span> <span class="s">"sports"</span><span class="o">,</span>
                    <span class="s">"test_group"</span><span class="o">,</span> <span class="s">"timezone"</span><span class="o">,</span> <span class="s">"third_party_id"</span><span class="o">,</span>
                    <span class="s">"updated_time"</span><span class="o">,</span> <span class="s">"verified"</span><span class="o">,</span> <span class="s">"video_upload_limits"</span><span class="o">,</span> <span class="s">"viewer_can_send_gift"</span><span class="o">,</span> <span class="s">"website"</span><span class="o">,</span> <span class="s">"work"</span><span class="o">};</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="nc">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"org.springframework.social.facebook.api.UserOperations"</span><span class="o">).</span>
    <span class="n">getDeclaredField</span><span class="o">(</span><span class="s">"PROFILE_FIELDS"</span><span class="o">);</span>
    <span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

    <span class="nc">Field</span> <span class="n">modifiers</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">"modifiers"</span><span class="o">);</span>
    <span class="n">modifiers</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">modifiers</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">field</span><span class="o">.</span><span class="na">getModifiers</span><span class="o">()</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nc">Modifier</span><span class="o">.</span><span class="na">FINAL</span><span class="o">);</span>
    <span class="n">field</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">fields</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>í•˜ì§€ë§Œ ì—¬ì „íˆ ì½”ë“œê°€ ë„ˆë¬´ ë‚œì¡í•´ì§€ëŠ” íš¨ê³¼ê°€â€¦
<strong>ê·¸ë˜ì„œ! SNSë§ˆë‹¤ oAuth1ê³¼ oAuth2ë¥¼ ì§€ì›í•˜ëŠ” ê²ƒì´ ê°ê° ë‹¤ë¥´ê¸° ë•Œë¬¸ì— oAuthë¥¼ í†µí•©í•´ì£¼ëŠ” ê¸°ëŠ¥ì„ ì°¾ë‹¤ë³´ë‹ˆ Spring Social-core, connectController, ProviderSigninController, auth ë“±ì˜ ë‚´ìš©ì´ ë‚˜ì™€ì„œ ì‹œë„í–ˆì§€ë§Œ, ë¶ˆí•„ìš”í•œ DB ì •ë³´ë“¤ì´ ë“¤ì–´ê°€ë¯€ë¡œ ê²°êµ­ ì œê°€ ë§ˆì§€ë§‰ì— ì„ íƒí•œ ë°©ë²•ì€ Spring Security oAuthì…ë‹ˆë‹¤!!</strong></p>

<p>Spring Security oAuthë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ê°„ë‹¨í•œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤! (í¸ì˜ìƒ facebook ì½”ë“œë§Œ ë³´ê² ìŠµë‹ˆë‹¤)</p>

<figure class="highlight"><pre><code class="language-yml" data-lang="yml"><span class="na">facebook </span><span class="pi">:</span>
  <span class="na">client </span><span class="pi">:</span>
    <span class="na">client-id</span><span class="pi">:</span>
    <span class="na">client-secret</span><span class="pi">:</span>
    <span class="na">access-token-uri</span><span class="pi">:</span> <span class="s">https://graph.facebook.com/oauth/access_token</span>
    <span class="na">user-authorization-uri</span><span class="pi">:</span> <span class="s">https://www.facebook.com/dialog/oauth?display=popup</span>
    <span class="na">token-name</span><span class="pi">:</span> <span class="s">oauth_token</span>
    <span class="na">authentication-scheme</span><span class="pi">:</span> <span class="s">query</span>
    <span class="na">client-authentication-scheme</span><span class="pi">:</span> <span class="s">form</span>
    <span class="na">scope</span><span class="pi">:</span> <span class="s">publish_actions, public_profile, email</span>
  <span class="na">resource</span><span class="pi">:</span>
    <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://graph.facebook.com/me</span>
<span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span></code></pre></figure>

<p>ì´ë ‡ê²Œ ì„¤ì •ì„ ë§ˆì¹œ í›„ì— Securityë¥¼ ì†ë´ì¤ë‹ˆë‹¤!</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="nc">CharacterEncodingFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CharacterEncodingFilter</span><span class="o">();</span>
  <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
      <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/comment/post"</span><span class="o">,</span> <span class="s">"/warning"</span><span class="o">).</span><span class="na">authenticated</span><span class="o">()</span>
      <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"/login/**"</span><span class="o">,</span> <span class="s">"/logout"</span><span class="o">,</span> <span class="s">"/twitter/complete"</span><span class="o">,</span> <span class="s">"/comment/**"</span><span class="o">,</span> <span class="s">"/resources/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
      <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
      <span class="o">.</span><span class="na">and</span><span class="o">()</span>
      <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
      <span class="o">.</span><span class="na">and</span><span class="o">()</span>
      <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">()</span>
      <span class="o">.</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoginUrlAuthenticationEntryPoint</span><span class="o">(</span><span class="s">"/"</span><span class="o">))</span>
      <span class="o">.</span><span class="na">and</span><span class="o">()</span>
      <span class="o">.</span><span class="na">logout</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
      <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">filter</span><span class="o">,</span> <span class="nc">CsrfFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
      <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">ssoFilter</span><span class="o">(),</span> <span class="nc">BasicAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">FilterRegistrationBean</span> <span class="nf">oauth2ClientFilterRegistration</span><span class="o">(</span><span class="nc">OAuth2ClientContextFilter</span> <span class="n">filter</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">FilterRegistrationBean</span> <span class="n">registration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FilterRegistrationBean</span><span class="o">();</span>
  <span class="n">registration</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
  <span class="n">registration</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(-</span><span class="mi">100</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">registration</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">Filter</span> <span class="nf">ssoFilter</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">CompositeFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CompositeFilter</span><span class="o">();</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Filter</span><span class="o">&gt;</span> <span class="n">filters</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="n">filters</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ssoFilter</span><span class="o">(</span><span class="n">facebook</span><span class="o">(),</span> <span class="s">"/login/facebook"</span><span class="o">,</span> <span class="nc">SocialType</span><span class="o">.</span><span class="na">FACEBOOK</span><span class="o">));</span>
  <span class="n">filter</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="n">filters</span><span class="o">);</span>
  <span class="k">return</span> <span class="n">filter</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="nc">Filter</span> <span class="nf">ssoFilter</span><span class="o">(</span><span class="nc">ClientResources</span> <span class="n">client</span><span class="o">,</span> <span class="nc">String</span> <span class="n">path</span><span class="o">,</span> <span class="nc">SocialType</span> <span class="n">socialType</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">OAuth2ClientAuthenticationProcessingFilter</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuth2ClientAuthenticationProcessingFilter</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
  <span class="nc">OAuth2RestTemplate</span> <span class="n">template</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OAuth2RestTemplate</span><span class="o">(</span><span class="n">client</span><span class="o">.</span><span class="na">getClient</span><span class="o">(),</span> <span class="n">oAuth2ClientContext</span><span class="o">);</span>
  <span class="n">filter</span><span class="o">.</span><span class="na">setRestTemplate</span><span class="o">(</span><span class="n">template</span><span class="o">);</span>
  <span class="n">filter</span><span class="o">.</span><span class="na">setTokenServices</span><span class="o">(</span><span class="k">new</span> <span class="nc">UserTokenService</span><span class="o">(</span><span class="n">client</span><span class="o">,</span> <span class="n">socialType</span><span class="o">));</span>
  <span class="n">filter</span><span class="o">.</span><span class="na">setAuthenticationSuccessHandler</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">authentication</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/facebook/complete"</span><span class="o">));</span>
  <span class="n">filter</span><span class="o">.</span><span class="na">setAuthenticationFailureHandler</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">exception</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/"</span><span class="o">));</span>
  <span class="k">return</span> <span class="n">filter</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="s">"facebook"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ClientResources</span> <span class="nf">facebook</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">ClientResources</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Facebookì— ëŒ€í•œ ìš”ì²­ì„ filterì— ë“±ë¡í•˜ë©´ ë¡œê·¸ì¸ê¹Œì§€ Spring Securityì—ì„œ ê´€ë¦¬í•´ì¤ë‹ˆë‹¤.(Security ë„ˆë€ ë†ˆ.. b)
ë¡œê·¸ì¸ì´ ì„±ê³µí–ˆì„ ë•Œ callback urlì„ /facebook/completeìœ¼ë¡œ ì§€ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— Authentication ëŒ€ì‹  OAuth2Authenticationì„ parameterë¡œ ë°›ìœ¼ë©´ ë¡œê·¸ì¸ access tokenì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!
ë˜í•œ, ë³„ë„ë¡œ access tokenì„ ì €ì¥í•˜ê±°ë‚˜ ê´€ë¦¬í•˜ì§€ ì•Šê¸° ë–„ë¬¸ì— ë‹¤ë¥¸ ë°©ë²•ë³´ë‹¤ ë” ê¹”ë”í•œ êµ¬ì¡°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/facebook/complete"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">facebookComplete</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nc">OAuth2Authentication</span> <span class="n">auth</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">String</span> <span class="n">userName</span><span class="o">;</span>
  <span class="nc">String</span> <span class="n">userPrincipal</span><span class="o">;</span>
  <span class="nc">String</span> <span class="n">socialValue</span><span class="o">;</span>

  <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;)</span> <span class="n">auth</span><span class="o">.</span><span class="na">getUserAuthentication</span><span class="o">().</span><span class="na">getDetails</span><span class="o">();</span>

  <span class="n">userName</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>
  <span class="n">userPrincipal</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"id"</span><span class="o">);</span>

  <span class="nc">String</span> <span class="n">userImage</span> <span class="o">=</span> <span class="s">"http://graph.facebook.com/"</span> <span class="o">+</span> <span class="n">userPrincipal</span> <span class="o">+</span> <span class="s">"/picture?type=square"</span><span class="o">;</span>
  <span class="n">socialValue</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">().</span><span class="na">toArray</span><span class="o">()[</span><span class="mi">0</span><span class="o">].</span><span class="na">toString</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">"_"</span><span class="o">)[</span><span class="mi">1</span><span class="o">];</span>
  <span class="nc">String</span> <span class="n">userUrl</span> <span class="o">=</span> <span class="s">"https://facebook.com/"</span><span class="o">+</span><span class="n">userPrincipal</span><span class="o">;</span>

  <span class="k">if</span> <span class="o">(!</span><span class="n">userService</span><span class="o">.</span><span class="na">isUserExist</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">userPrincipal</span><span class="o">,</span> <span class="nc">SocialType</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">socialValue</span><span class="o">)))</span> <span class="o">{</span>
      <span class="n">userService</span><span class="o">.</span><span class="na">saveUser</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">userPrincipal</span><span class="o">,</span> <span class="nc">SocialType</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">socialValue</span><span class="o">),</span> <span class="n">userImage</span><span class="o">,</span> <span class="n">serUrl</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="nc">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">getUser</span><span class="o">(</span><span class="n">userName</span><span class="o">,</span> <span class="n">userPrincipal</span><span class="o">,</span> <span class="nc">SocialType</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">socialValue</span><span class="o">));</span>
<span class="o">}</span></code></pre></figure>

<p><strong>ì ì´ì œ ë¡œê·¸ì¸ì„ í•˜ì˜€ìœ¼ë‹ˆ ì‘ì„±í•œ ëŒ“ê¸€ì„ ê¸€ê³¼ í•¨ê»˜ SNSì— ê³µìœ í•˜ëŠ” ì½”ë“œë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤!<br />
ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìì˜ access tokenìœ¼ë¡œ ê¶Œí•œì„ ë°›ì€ í›„ ìƒì„±í•œ ë©”ì‹œì§€ì™€ í•¨ê»˜ ë“±ë¡í•˜ë©´ ë!</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">OAuth2ClientContext</span> <span class="n">context</span><span class="o">;</span>

<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/post"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">postComment</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"message"</span><span class="o">);</span>
  <span class="nc">String</span> <span class="n">isShare</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"is_share"</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(!</span><span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"anonymousUser"</span><span class="o">))</span> <span class="o">{</span>
    <span class="o">...</span>
      <span class="n">commentService</span><span class="o">.</span><span class="na">createComment</span><span class="o">(</span><span class="n">message</span><span class="o">...)</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">isShare</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">isShare</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"on"</span><span class="o">))</span> <span class="o">{</span>  
          <span class="nc">String</span> <span class="n">postLink</span> <span class="o">=</span> <span class="s">"http://hub.demo.zum.com/view.html"</span><span class="o">;</span>
          <span class="k">if</span> <span class="o">(</span><span class="n">socialValue</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"facebook"</span><span class="o">))</span> <span class="o">{</span>
              <span class="n">facebook</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FacebookTemplate</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getAccessToken</span><span class="o">().</span><span class="na">getValue</span><span class="o">());</span>
              <span class="nc">FacebookLink</span> <span class="n">link</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FacebookLink</span><span class="o">(</span><span class="n">postLink</span><span class="o">,</span> <span class="s">"ZUM í—ˆë¸Œì¤Œ"</span><span class="o">,</span> <span class="s">"ë¼ì´í”„"</span><span class="o">,</span> <span class="s">"ìš”ì¦˜ ë”°ë¼ ì •ë§ ìì£¼ ë³´ì´ëŠ” ê·¸ê²ƒ, í•´ì‹œíƒœê·¸ Haxhtag"</span><span class="o">);</span>
              <span class="n">facebook</span><span class="o">.</span><span class="na">feedOperations</span><span class="o">().</span><span class="na">postLink</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">link</span><span class="o">);</span>
          <span class="o">}</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>ê²°ê³¼ëŠ” ë°”ë¡œ!!<br />
<img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/social_result.PNG" alt="ì†Œì…œ ëŒ“ê¸€ ê²°ê³¼" /></p>

<p><strong>ëŒ“ê¸€ì´ ë“±ë¡ë¨ê³¼ í•¨ê»˜ facebook ë‹´ë²¼ë½ì— ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ê³¼ ê¸€ì´ í•¨ê»˜ ê³µìœ ë©ë‹ˆë‹¤!</strong></p>

<p><img src="/images/portal/post/2017-02-24-ZUM-Pilot-jeonghoon/thumbsup.jpg" alt="ì—„ì§€ ì²™" /></p>

<h2 id="ëŠë‚€-ì ">ëŠë‚€ ì </h2>
<p>ZUMì— ì…ì‚¬í•˜ì—¬ ë‘ ê°œì˜ íŒŒì¼ëŸ¿ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ì§ˆë¬¸ì„ í•˜ì§€ ì•Šê³  ìŠ¤ìŠ¤ë¡œ í•´ê²°í•´ ë‚˜ì•„ê°€ëŠ” ê²ƒì´ ì‹ ì…ì‚¬ì›ì˜ ì…ì¥ì—ì„œëŠ” ì •ë§ í˜ë“  ì¼ì´ì—ˆìŠµë‹ˆë‹¤.. í•˜ì§€ë§Œ ëŒì´ì¼œë³´ë©´ ì„¤ê³„ë¶€í„° ê°œë°œê¹Œì§€ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ê³  ë¬¸ì œë¥¼ í•´ê²°í•´ ë‚˜ì•„ê°€ê¸°ì— ê°œë°œìë¡œì¨ ì„±ì¥í•˜ê³  ìˆë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. <strong>ë¬´ì—‡ë³´ë‹¤ ìŠ¤ìŠ¤ë¡œ í•˜ëŠ” ëª¨ë“  ì¼ë§ˆë‹¤ â€œì™œ, ë¬´ì—‡ë•Œë¬¸ì—, ì´ê²Œ ìµœì„ ì¸ê°€â€ë¼ê³  ëì—†ì´ ì˜ì‹¬í•˜ê³  ë” í™•ì‹¤í•œ ë°©ë²•ì„ í˜¹ì€ ë” ì¢‹ì€ ë°©ë²•ì„ ì°¾ì•„ë‚˜ê°€ëŠ” ì œ ìì‹ ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</strong></p>

<p>íŒŒì¼ëŸ¿ í”„ë¡œì íŠ¸ëŠ” ìŠ¤ìŠ¤ë¡œ ë°œì „í•  ìˆ˜ ìˆëŠ” ê¸°íšŒë¥¼ ì—´ì–´ì£¼ëŠ” ì„ ì„ë“¤ì´ ì£¼ì‹œëŠ” ìµœê³ ì˜ ì„ ë¬¼ì´ì—ˆìŠµë‹ˆë‹¤!</p>

<p>ì´ì œëŠ” ZUMì˜ â€˜ì§„ì§œâ€™ ê°œë°œìë¡œì¨ ì‚¬ëŒë“¤ì—ê²Œ ë” í¸ë¦¬í•œ ì •ë³´ë¥¼ ì£¼ê³  ë” ì¢‹ì€ ì„œë¹„ìŠ¤ë¥¼ ì£¼ê¸° ìœ„í•´ ë…¸ë ¥í•˜ëŠ” ê°œë°œìê°€ ë  ê²ƒì…ë‹ˆë‹¤!</p>

<p>ë§ì´ ë¶€ì¡±í•œ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
:ET